<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>lerna + yarn workspace 使用总结 | Ailjc notes</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel=" " href=" ">
    <meta name="description" content=" ">
    
    <link rel="preload" href="/luvue/assets/css/0.styles.0c275c11.css" as="style"><link rel="preload" href="/luvue/assets/js/app.50227b6d.js" as="script"><link rel="preload" href="/luvue/assets/js/2.dc297d8e.js" as="script"><link rel="preload" href="/luvue/assets/js/3.51a2d233.js" as="script"><link rel="preload" href="/luvue/assets/js/57.97fdefbb.js" as="script"><link rel="prefetch" href="/luvue/assets/js/10.4dcff8ef.js"><link rel="prefetch" href="/luvue/assets/js/100.4a463fa3.js"><link rel="prefetch" href="/luvue/assets/js/101.16c4fcf8.js"><link rel="prefetch" href="/luvue/assets/js/102.5b1d6c4c.js"><link rel="prefetch" href="/luvue/assets/js/103.14584991.js"><link rel="prefetch" href="/luvue/assets/js/104.116f4d80.js"><link rel="prefetch" href="/luvue/assets/js/105.81576762.js"><link rel="prefetch" href="/luvue/assets/js/106.5757f0a1.js"><link rel="prefetch" href="/luvue/assets/js/107.011fc1df.js"><link rel="prefetch" href="/luvue/assets/js/108.502e4c8c.js"><link rel="prefetch" href="/luvue/assets/js/109.904aca6f.js"><link rel="prefetch" href="/luvue/assets/js/11.e6154571.js"><link rel="prefetch" href="/luvue/assets/js/110.97e25b5c.js"><link rel="prefetch" href="/luvue/assets/js/111.edcade6b.js"><link rel="prefetch" href="/luvue/assets/js/112.75c283fd.js"><link rel="prefetch" href="/luvue/assets/js/113.ac993ad7.js"><link rel="prefetch" href="/luvue/assets/js/114.1dfc2617.js"><link rel="prefetch" href="/luvue/assets/js/115.a55cebf2.js"><link rel="prefetch" href="/luvue/assets/js/116.e3650879.js"><link rel="prefetch" href="/luvue/assets/js/117.c98d9d80.js"><link rel="prefetch" href="/luvue/assets/js/118.2ef2cb19.js"><link rel="prefetch" href="/luvue/assets/js/119.a56e96cb.js"><link rel="prefetch" href="/luvue/assets/js/12.271e8805.js"><link rel="prefetch" href="/luvue/assets/js/120.ea37c8e9.js"><link rel="prefetch" href="/luvue/assets/js/121.e84aa3eb.js"><link rel="prefetch" href="/luvue/assets/js/122.2809183d.js"><link rel="prefetch" href="/luvue/assets/js/123.ef109ed8.js"><link rel="prefetch" href="/luvue/assets/js/124.d7a754ba.js"><link rel="prefetch" href="/luvue/assets/js/125.e368457d.js"><link rel="prefetch" href="/luvue/assets/js/126.2b1e6d99.js"><link rel="prefetch" href="/luvue/assets/js/127.d197f125.js"><link rel="prefetch" href="/luvue/assets/js/128.1a3bba89.js"><link rel="prefetch" href="/luvue/assets/js/129.43fa9b4c.js"><link rel="prefetch" href="/luvue/assets/js/13.f6b3db37.js"><link rel="prefetch" href="/luvue/assets/js/130.ff13b9c1.js"><link rel="prefetch" href="/luvue/assets/js/131.25eb4de5.js"><link rel="prefetch" href="/luvue/assets/js/132.386f97d9.js"><link rel="prefetch" href="/luvue/assets/js/133.defdd861.js"><link rel="prefetch" href="/luvue/assets/js/134.0aba29a4.js"><link rel="prefetch" href="/luvue/assets/js/135.f1cc2592.js"><link rel="prefetch" href="/luvue/assets/js/136.5fea8f28.js"><link rel="prefetch" href="/luvue/assets/js/137.15521ec2.js"><link rel="prefetch" href="/luvue/assets/js/138.2e96476f.js"><link rel="prefetch" href="/luvue/assets/js/139.b3e580c7.js"><link rel="prefetch" href="/luvue/assets/js/14.e2545646.js"><link rel="prefetch" href="/luvue/assets/js/140.7254c946.js"><link rel="prefetch" href="/luvue/assets/js/141.309b75d5.js"><link rel="prefetch" href="/luvue/assets/js/142.e1587e8c.js"><link rel="prefetch" href="/luvue/assets/js/143.c6e04498.js"><link rel="prefetch" href="/luvue/assets/js/144.ccf79776.js"><link rel="prefetch" href="/luvue/assets/js/145.faa65998.js"><link rel="prefetch" href="/luvue/assets/js/146.1b7c11e7.js"><link rel="prefetch" href="/luvue/assets/js/147.f19de9ec.js"><link rel="prefetch" href="/luvue/assets/js/148.aba5552d.js"><link rel="prefetch" href="/luvue/assets/js/149.f1c10580.js"><link rel="prefetch" href="/luvue/assets/js/15.a3a78949.js"><link rel="prefetch" href="/luvue/assets/js/150.8c715a8a.js"><link rel="prefetch" href="/luvue/assets/js/151.1d867a79.js"><link rel="prefetch" href="/luvue/assets/js/152.22ae9445.js"><link rel="prefetch" href="/luvue/assets/js/153.1024de46.js"><link rel="prefetch" href="/luvue/assets/js/154.48bb1114.js"><link rel="prefetch" href="/luvue/assets/js/155.bd946cd8.js"><link rel="prefetch" href="/luvue/assets/js/156.f1d78b05.js"><link rel="prefetch" href="/luvue/assets/js/157.63356c24.js"><link rel="prefetch" href="/luvue/assets/js/158.44bfb42f.js"><link rel="prefetch" href="/luvue/assets/js/159.41731d4e.js"><link rel="prefetch" href="/luvue/assets/js/16.bdbc9ac3.js"><link rel="prefetch" href="/luvue/assets/js/160.fe64fd3e.js"><link rel="prefetch" href="/luvue/assets/js/161.3af3f899.js"><link rel="prefetch" href="/luvue/assets/js/162.a020acea.js"><link rel="prefetch" href="/luvue/assets/js/163.ebfa2fea.js"><link rel="prefetch" href="/luvue/assets/js/164.5c72d951.js"><link rel="prefetch" href="/luvue/assets/js/165.739d51ec.js"><link rel="prefetch" href="/luvue/assets/js/166.54be55b5.js"><link rel="prefetch" href="/luvue/assets/js/167.6f6b0af9.js"><link rel="prefetch" href="/luvue/assets/js/168.059c4bbb.js"><link rel="prefetch" href="/luvue/assets/js/169.9583f311.js"><link rel="prefetch" href="/luvue/assets/js/17.267c53f7.js"><link rel="prefetch" href="/luvue/assets/js/170.f7ab2a56.js"><link rel="prefetch" href="/luvue/assets/js/171.aa5c6d65.js"><link rel="prefetch" href="/luvue/assets/js/172.7b70d120.js"><link rel="prefetch" href="/luvue/assets/js/173.8d733f83.js"><link rel="prefetch" href="/luvue/assets/js/174.41a36264.js"><link rel="prefetch" href="/luvue/assets/js/175.643cec2e.js"><link rel="prefetch" href="/luvue/assets/js/176.17a19152.js"><link rel="prefetch" href="/luvue/assets/js/177.00bffe2d.js"><link rel="prefetch" href="/luvue/assets/js/178.39d6dd1d.js"><link rel="prefetch" href="/luvue/assets/js/179.97c25b6d.js"><link rel="prefetch" href="/luvue/assets/js/18.b4dc00ad.js"><link rel="prefetch" href="/luvue/assets/js/180.f001f92c.js"><link rel="prefetch" href="/luvue/assets/js/181.b4ff3df9.js"><link rel="prefetch" href="/luvue/assets/js/182.21c49e0c.js"><link rel="prefetch" href="/luvue/assets/js/183.a68aedcf.js"><link rel="prefetch" href="/luvue/assets/js/184.1cc2979e.js"><link rel="prefetch" href="/luvue/assets/js/185.820ead5b.js"><link rel="prefetch" href="/luvue/assets/js/186.2ad000ef.js"><link rel="prefetch" href="/luvue/assets/js/187.fa9b511d.js"><link rel="prefetch" href="/luvue/assets/js/188.cfcaabfb.js"><link rel="prefetch" href="/luvue/assets/js/189.c7913649.js"><link rel="prefetch" href="/luvue/assets/js/19.61df46ad.js"><link rel="prefetch" href="/luvue/assets/js/190.a66da869.js"><link rel="prefetch" href="/luvue/assets/js/191.d21b8a3e.js"><link rel="prefetch" href="/luvue/assets/js/192.3a3f0b99.js"><link rel="prefetch" href="/luvue/assets/js/193.6005ffb1.js"><link rel="prefetch" href="/luvue/assets/js/194.9b365175.js"><link rel="prefetch" href="/luvue/assets/js/195.4e4e83f5.js"><link rel="prefetch" href="/luvue/assets/js/196.24df233b.js"><link rel="prefetch" href="/luvue/assets/js/197.42cfce0b.js"><link rel="prefetch" href="/luvue/assets/js/198.3998b360.js"><link rel="prefetch" href="/luvue/assets/js/199.6e1b267e.js"><link rel="prefetch" href="/luvue/assets/js/20.ae4d73d6.js"><link rel="prefetch" href="/luvue/assets/js/200.78a26196.js"><link rel="prefetch" href="/luvue/assets/js/201.e15689f7.js"><link rel="prefetch" href="/luvue/assets/js/202.351e4200.js"><link rel="prefetch" href="/luvue/assets/js/203.6732fa0f.js"><link rel="prefetch" href="/luvue/assets/js/204.bdaedc2f.js"><link rel="prefetch" href="/luvue/assets/js/205.769cfdfa.js"><link rel="prefetch" href="/luvue/assets/js/206.5980160d.js"><link rel="prefetch" href="/luvue/assets/js/207.4f27fd16.js"><link rel="prefetch" href="/luvue/assets/js/208.f715439d.js"><link rel="prefetch" href="/luvue/assets/js/209.26ff4509.js"><link rel="prefetch" href="/luvue/assets/js/21.756c7992.js"><link rel="prefetch" href="/luvue/assets/js/210.7c211a09.js"><link rel="prefetch" href="/luvue/assets/js/211.70a47632.js"><link rel="prefetch" href="/luvue/assets/js/212.fda6d44b.js"><link rel="prefetch" href="/luvue/assets/js/213.ec7d646a.js"><link rel="prefetch" href="/luvue/assets/js/214.3c165f1f.js"><link rel="prefetch" href="/luvue/assets/js/215.79377a1f.js"><link rel="prefetch" href="/luvue/assets/js/216.1300dd6d.js"><link rel="prefetch" href="/luvue/assets/js/217.1ee87399.js"><link rel="prefetch" href="/luvue/assets/js/218.6f58fde9.js"><link rel="prefetch" href="/luvue/assets/js/219.3e5ec5b0.js"><link rel="prefetch" href="/luvue/assets/js/22.68b75c4f.js"><link rel="prefetch" href="/luvue/assets/js/220.bac8627d.js"><link rel="prefetch" href="/luvue/assets/js/221.65afbd17.js"><link rel="prefetch" href="/luvue/assets/js/222.10b495b9.js"><link rel="prefetch" href="/luvue/assets/js/223.9483fde2.js"><link rel="prefetch" href="/luvue/assets/js/224.f0f0b115.js"><link rel="prefetch" href="/luvue/assets/js/225.82f4db59.js"><link rel="prefetch" href="/luvue/assets/js/226.837beb3c.js"><link rel="prefetch" href="/luvue/assets/js/227.88dfd603.js"><link rel="prefetch" href="/luvue/assets/js/228.926b67f1.js"><link rel="prefetch" href="/luvue/assets/js/229.d5432625.js"><link rel="prefetch" href="/luvue/assets/js/23.f144c5d8.js"><link rel="prefetch" href="/luvue/assets/js/230.af30858c.js"><link rel="prefetch" href="/luvue/assets/js/231.d094a5d4.js"><link rel="prefetch" href="/luvue/assets/js/232.001ef00e.js"><link rel="prefetch" href="/luvue/assets/js/233.63941e40.js"><link rel="prefetch" href="/luvue/assets/js/234.942f27c3.js"><link rel="prefetch" href="/luvue/assets/js/235.304392bc.js"><link rel="prefetch" href="/luvue/assets/js/236.d9a2338f.js"><link rel="prefetch" href="/luvue/assets/js/237.3e31a7be.js"><link rel="prefetch" href="/luvue/assets/js/238.50a6e0a4.js"><link rel="prefetch" href="/luvue/assets/js/239.67f7ea74.js"><link rel="prefetch" href="/luvue/assets/js/24.050e500e.js"><link rel="prefetch" href="/luvue/assets/js/240.7e126350.js"><link rel="prefetch" href="/luvue/assets/js/241.4b6526f2.js"><link rel="prefetch" href="/luvue/assets/js/242.2c0594df.js"><link rel="prefetch" href="/luvue/assets/js/243.2947ca1f.js"><link rel="prefetch" href="/luvue/assets/js/244.c13ff375.js"><link rel="prefetch" href="/luvue/assets/js/245.f35e7258.js"><link rel="prefetch" href="/luvue/assets/js/246.a4160daf.js"><link rel="prefetch" href="/luvue/assets/js/247.5add7de3.js"><link rel="prefetch" href="/luvue/assets/js/248.285f48bf.js"><link rel="prefetch" href="/luvue/assets/js/249.6bfc19fe.js"><link rel="prefetch" href="/luvue/assets/js/25.7161d756.js"><link rel="prefetch" href="/luvue/assets/js/250.7d9d5a0d.js"><link rel="prefetch" href="/luvue/assets/js/251.ad83fc91.js"><link rel="prefetch" href="/luvue/assets/js/252.79ce4a94.js"><link rel="prefetch" href="/luvue/assets/js/253.6733159c.js"><link rel="prefetch" href="/luvue/assets/js/254.8cbd88de.js"><link rel="prefetch" href="/luvue/assets/js/255.a6ded312.js"><link rel="prefetch" href="/luvue/assets/js/256.4a6348be.js"><link rel="prefetch" href="/luvue/assets/js/257.16709fb2.js"><link rel="prefetch" href="/luvue/assets/js/258.65f7c45d.js"><link rel="prefetch" href="/luvue/assets/js/259.d6bf3339.js"><link rel="prefetch" href="/luvue/assets/js/26.da9ec7cd.js"><link rel="prefetch" href="/luvue/assets/js/260.2e2fc30d.js"><link rel="prefetch" href="/luvue/assets/js/261.8ed2d945.js"><link rel="prefetch" href="/luvue/assets/js/262.02d4d5ca.js"><link rel="prefetch" href="/luvue/assets/js/263.8a02e4d0.js"><link rel="prefetch" href="/luvue/assets/js/264.5fad29a4.js"><link rel="prefetch" href="/luvue/assets/js/265.1cd29535.js"><link rel="prefetch" href="/luvue/assets/js/266.e5a1aad7.js"><link rel="prefetch" href="/luvue/assets/js/267.a51a94be.js"><link rel="prefetch" href="/luvue/assets/js/268.5d9bc388.js"><link rel="prefetch" href="/luvue/assets/js/269.81be7c5e.js"><link rel="prefetch" href="/luvue/assets/js/27.d35fe8d8.js"><link rel="prefetch" href="/luvue/assets/js/270.bf9cf8c5.js"><link rel="prefetch" href="/luvue/assets/js/271.f5f0e39d.js"><link rel="prefetch" href="/luvue/assets/js/272.2c2d8519.js"><link rel="prefetch" href="/luvue/assets/js/273.207adc32.js"><link rel="prefetch" href="/luvue/assets/js/274.4dceda17.js"><link rel="prefetch" href="/luvue/assets/js/275.c1310482.js"><link rel="prefetch" href="/luvue/assets/js/276.4201cd6e.js"><link rel="prefetch" href="/luvue/assets/js/277.88e1d30f.js"><link rel="prefetch" href="/luvue/assets/js/278.5914996c.js"><link rel="prefetch" href="/luvue/assets/js/279.74b37999.js"><link rel="prefetch" href="/luvue/assets/js/28.07d99649.js"><link rel="prefetch" href="/luvue/assets/js/280.c9568110.js"><link rel="prefetch" href="/luvue/assets/js/281.9f65d139.js"><link rel="prefetch" href="/luvue/assets/js/282.1650bd06.js"><link rel="prefetch" href="/luvue/assets/js/283.33bbeb99.js"><link rel="prefetch" href="/luvue/assets/js/284.1abe4631.js"><link rel="prefetch" href="/luvue/assets/js/285.518df1bf.js"><link rel="prefetch" href="/luvue/assets/js/286.af519e66.js"><link rel="prefetch" href="/luvue/assets/js/287.b6460486.js"><link rel="prefetch" href="/luvue/assets/js/288.47db7cc9.js"><link rel="prefetch" href="/luvue/assets/js/289.33cc7dc0.js"><link rel="prefetch" href="/luvue/assets/js/29.7a42aa9c.js"><link rel="prefetch" href="/luvue/assets/js/290.4a4def2b.js"><link rel="prefetch" href="/luvue/assets/js/291.ff1d48f1.js"><link rel="prefetch" href="/luvue/assets/js/292.0e4d6a16.js"><link rel="prefetch" href="/luvue/assets/js/293.4475f8fa.js"><link rel="prefetch" href="/luvue/assets/js/294.19226719.js"><link rel="prefetch" href="/luvue/assets/js/295.09aea195.js"><link rel="prefetch" href="/luvue/assets/js/296.98217b5e.js"><link rel="prefetch" href="/luvue/assets/js/297.b8ff51d6.js"><link rel="prefetch" href="/luvue/assets/js/298.990d4d9f.js"><link rel="prefetch" href="/luvue/assets/js/299.5df2719c.js"><link rel="prefetch" href="/luvue/assets/js/30.f14df500.js"><link rel="prefetch" href="/luvue/assets/js/300.fffd2c27.js"><link rel="prefetch" href="/luvue/assets/js/301.3d6b453a.js"><link rel="prefetch" href="/luvue/assets/js/302.caa4deb9.js"><link rel="prefetch" href="/luvue/assets/js/303.7a1ad789.js"><link rel="prefetch" href="/luvue/assets/js/304.fd6421f9.js"><link rel="prefetch" href="/luvue/assets/js/305.9963fce8.js"><link rel="prefetch" href="/luvue/assets/js/306.20906cc0.js"><link rel="prefetch" href="/luvue/assets/js/307.9b2c7f2f.js"><link rel="prefetch" href="/luvue/assets/js/308.c6636c3c.js"><link rel="prefetch" href="/luvue/assets/js/309.ba0a0e71.js"><link rel="prefetch" href="/luvue/assets/js/31.8b2636da.js"><link rel="prefetch" href="/luvue/assets/js/310.22345224.js"><link rel="prefetch" href="/luvue/assets/js/311.7c423dba.js"><link rel="prefetch" href="/luvue/assets/js/312.1a9b57a9.js"><link rel="prefetch" href="/luvue/assets/js/313.358832dc.js"><link rel="prefetch" href="/luvue/assets/js/314.cc992c63.js"><link rel="prefetch" href="/luvue/assets/js/315.51fdd92e.js"><link rel="prefetch" href="/luvue/assets/js/32.a1812ddd.js"><link rel="prefetch" href="/luvue/assets/js/33.4f4d5e3f.js"><link rel="prefetch" href="/luvue/assets/js/34.d81874f6.js"><link rel="prefetch" href="/luvue/assets/js/35.808cadca.js"><link rel="prefetch" href="/luvue/assets/js/36.911edf94.js"><link rel="prefetch" href="/luvue/assets/js/37.4718c1c4.js"><link rel="prefetch" href="/luvue/assets/js/38.a71b26b8.js"><link rel="prefetch" href="/luvue/assets/js/39.1e2c90a1.js"><link rel="prefetch" href="/luvue/assets/js/4.81c04c44.js"><link rel="prefetch" href="/luvue/assets/js/40.c27fa3a1.js"><link rel="prefetch" href="/luvue/assets/js/41.7ef6ece6.js"><link rel="prefetch" href="/luvue/assets/js/42.65a4e5f1.js"><link rel="prefetch" href="/luvue/assets/js/43.fe8f1ca9.js"><link rel="prefetch" href="/luvue/assets/js/44.4cbd0be7.js"><link rel="prefetch" href="/luvue/assets/js/45.7ba58c4e.js"><link rel="prefetch" href="/luvue/assets/js/46.5b26ac52.js"><link rel="prefetch" href="/luvue/assets/js/47.4886ee59.js"><link rel="prefetch" href="/luvue/assets/js/48.6ca30618.js"><link rel="prefetch" href="/luvue/assets/js/49.bf5ae195.js"><link rel="prefetch" href="/luvue/assets/js/5.7c785cd7.js"><link rel="prefetch" href="/luvue/assets/js/50.d2063889.js"><link rel="prefetch" href="/luvue/assets/js/51.40853d68.js"><link rel="prefetch" href="/luvue/assets/js/52.4595cda0.js"><link rel="prefetch" href="/luvue/assets/js/53.f65e7aed.js"><link rel="prefetch" href="/luvue/assets/js/54.e92efc34.js"><link rel="prefetch" href="/luvue/assets/js/55.c19cb715.js"><link rel="prefetch" href="/luvue/assets/js/56.d9b2c912.js"><link rel="prefetch" href="/luvue/assets/js/58.a8454dc8.js"><link rel="prefetch" href="/luvue/assets/js/59.2176e352.js"><link rel="prefetch" href="/luvue/assets/js/6.f13ef292.js"><link rel="prefetch" href="/luvue/assets/js/60.9903c2e8.js"><link rel="prefetch" href="/luvue/assets/js/61.1840a87b.js"><link rel="prefetch" href="/luvue/assets/js/62.f9de293d.js"><link rel="prefetch" href="/luvue/assets/js/63.f0b5bd0c.js"><link rel="prefetch" href="/luvue/assets/js/64.9bfd9747.js"><link rel="prefetch" href="/luvue/assets/js/65.5091d072.js"><link rel="prefetch" href="/luvue/assets/js/66.1110c30b.js"><link rel="prefetch" href="/luvue/assets/js/67.d0123a6f.js"><link rel="prefetch" href="/luvue/assets/js/68.cfb6235b.js"><link rel="prefetch" href="/luvue/assets/js/69.eaef6f8c.js"><link rel="prefetch" href="/luvue/assets/js/7.b9daa433.js"><link rel="prefetch" href="/luvue/assets/js/70.92d45540.js"><link rel="prefetch" href="/luvue/assets/js/71.cea0d0db.js"><link rel="prefetch" href="/luvue/assets/js/72.5f4fd7b1.js"><link rel="prefetch" href="/luvue/assets/js/73.2bd9f09b.js"><link rel="prefetch" href="/luvue/assets/js/74.4f59112e.js"><link rel="prefetch" href="/luvue/assets/js/75.89861829.js"><link rel="prefetch" href="/luvue/assets/js/76.b02997f7.js"><link rel="prefetch" href="/luvue/assets/js/77.4d732275.js"><link rel="prefetch" href="/luvue/assets/js/78.338bc517.js"><link rel="prefetch" href="/luvue/assets/js/79.f4cf76b6.js"><link rel="prefetch" href="/luvue/assets/js/8.ae058ff6.js"><link rel="prefetch" href="/luvue/assets/js/80.598885dc.js"><link rel="prefetch" href="/luvue/assets/js/81.9e624105.js"><link rel="prefetch" href="/luvue/assets/js/82.70b483bb.js"><link rel="prefetch" href="/luvue/assets/js/83.96e15db9.js"><link rel="prefetch" href="/luvue/assets/js/84.1d0a2fca.js"><link rel="prefetch" href="/luvue/assets/js/85.c9523e2f.js"><link rel="prefetch" href="/luvue/assets/js/86.11b4914d.js"><link rel="prefetch" href="/luvue/assets/js/87.9e995a9e.js"><link rel="prefetch" href="/luvue/assets/js/88.768abc2b.js"><link rel="prefetch" href="/luvue/assets/js/89.889b6d0c.js"><link rel="prefetch" href="/luvue/assets/js/9.c7db66f1.js"><link rel="prefetch" href="/luvue/assets/js/90.3d24896e.js"><link rel="prefetch" href="/luvue/assets/js/91.0d861dc9.js"><link rel="prefetch" href="/luvue/assets/js/92.225a6a9c.js"><link rel="prefetch" href="/luvue/assets/js/93.52403ad6.js"><link rel="prefetch" href="/luvue/assets/js/94.603cf2a0.js"><link rel="prefetch" href="/luvue/assets/js/95.c46d3f66.js"><link rel="prefetch" href="/luvue/assets/js/96.fb8ddca9.js"><link rel="prefetch" href="/luvue/assets/js/97.492b0923.js"><link rel="prefetch" href="/luvue/assets/js/98.0a287ebb.js"><link rel="prefetch" href="/luvue/assets/js/99.1786ba72.js">
    <link rel="stylesheet" href="/luvue/assets/css/0.styles.0c275c11.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/luvue/" class="home-link router-link-active"><!----> <span class="site-name">Ailjc notes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/luvue/" class="nav-link">首页</a></div><div class="nav-item"><a href="/luvue/Js/" class="nav-link">Js</a></div><div class="nav-item"><a href="/luvue/react/" class="nav-link">React</a></div><div class="nav-item"><a href="/luvue/vuebase/" class="nav-link">快速掌握Vue</a></div><div class="nav-item"><a href="/luvue/node/" class="nav-link">Node</a></div><div class="nav-item"><a href="/luvue/typescript/" class="nav-link">Typescript</a></div><div class="nav-item"><a href="/luvue/vue3/" class="nav-link">Vue3</a></div><div class="nav-item"><a href="/luvue/vuesourcecode/" class="nav-link">源码分析</a></div><div class="nav-item"><a href="/luvue/lu-ui/" class="nav-link">组件库</a></div><div class="nav-item"><a href="/luvue/engineering/" class="nav-link router-link-active">工程化</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/luvue/" class="nav-link">首页</a></div><div class="nav-item"><a href="/luvue/Js/" class="nav-link">Js</a></div><div class="nav-item"><a href="/luvue/react/" class="nav-link">React</a></div><div class="nav-item"><a href="/luvue/vuebase/" class="nav-link">快速掌握Vue</a></div><div class="nav-item"><a href="/luvue/node/" class="nav-link">Node</a></div><div class="nav-item"><a href="/luvue/typescript/" class="nav-link">Typescript</a></div><div class="nav-item"><a href="/luvue/vue3/" class="nav-link">Vue3</a></div><div class="nav-item"><a href="/luvue/vuesourcecode/" class="nav-link">源码分析</a></div><div class="nav-item"><a href="/luvue/lu-ui/" class="nav-link">组件库</a></div><div class="nav-item"><a href="/luvue/engineering/" class="nav-link router-link-active">工程化</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/luvue/engineering/babel/" class="sidebar-heading clickable"><span>babel</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/luvue/engineering/cssPrecompiler/" class="sidebar-heading clickable"><span>cssPrecompiler</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/luvue/engineering/Loader/" class="sidebar-heading clickable"><span>Loader</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/luvue/engineering/other/" class="sidebar-heading clickable router-link-active open"><span>other</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/luvue/engineering/other/01-浏览器渲染原理与性能优化.html" class="sidebar-link">01-浏览器渲染原理与性能优化</a></li><li><a href="/luvue/engineering/other/02-lerna+yarn-workspace使用总结.html" class="active sidebar-link">02-lerna+yarn-workspace使用总结</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/luvue/engineering/other/02-lerna+yarn-workspace使用总结.html#模式对比" class="sidebar-link">模式对比</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/luvue/engineering/other/02-lerna+yarn-workspace使用总结.html#multirepo" class="sidebar-link">Multirepo</a></li><li class="sidebar-sub-header"><a href="/luvue/engineering/other/02-lerna+yarn-workspace使用总结.html#monorepo" class="sidebar-link">Monorepo</a></li><li class="sidebar-sub-header"><a href="/luvue/engineering/other/02-lerna+yarn-workspace使用总结.html#lerna-yarn-workspace-应用场景" class="sidebar-link">lerna + yarn workspace 应用场景</a></li></ul></li><li class="sidebar-sub-header"><a href="/luvue/engineering/other/02-lerna+yarn-workspace使用总结.html#lerna" class="sidebar-link">Lerna</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/luvue/engineering/other/02-lerna+yarn-workspace使用总结.html#lerna-管理模式" class="sidebar-link">Lerna 管理模式</a></li><li class="sidebar-sub-header"><a href="/luvue/engineering/other/02-lerna+yarn-workspace使用总结.html#lerna-入门指引" class="sidebar-link">Lerna 入门指引</a></li><li class="sidebar-sub-header"><a href="/luvue/engineering/other/02-lerna+yarn-workspace使用总结.html#lerna-管理命令" class="sidebar-link">Lerna 管理命令</a></li><li class="sidebar-sub-header"><a href="/luvue/engineering/other/02-lerna+yarn-workspace使用总结.html#lerna-配置文件" class="sidebar-link">Lerna 配置文件</a></li><li class="sidebar-sub-header"><a href="/luvue/engineering/other/02-lerna+yarn-workspace使用总结.html#lerna-应用-demo" class="sidebar-link">Lerna 应用 Demo</a></li><li class="sidebar-sub-header"><a href="/luvue/engineering/other/02-lerna+yarn-workspace使用总结.html#lerna-版本发布" class="sidebar-link">Lerna 版本发布</a></li><li class="sidebar-sub-header"><a href="/luvue/engineering/other/02-lerna+yarn-workspace使用总结.html#lerna-最佳实践" class="sidebar-link">Lerna 最佳实践</a></li><li class="sidebar-sub-header"><a href="/luvue/engineering/other/02-lerna+yarn-workspace使用总结.html#leran-注意事项" class="sidebar-link">Leran 注意事项</a></li></ul></li><li class="sidebar-sub-header"><a href="/luvue/engineering/other/02-lerna+yarn-workspace使用总结.html#yarn-workspace" class="sidebar-link">yarn workspace</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/luvue/engineering/other/02-lerna+yarn-workspace使用总结.html#yarn-workspace-管理工程" class="sidebar-link">yarn workspace 管理工程</a></li><li class="sidebar-sub-header"><a href="/luvue/engineering/other/02-lerna+yarn-workspace使用总结.html#yarn-workspace-管理命令" class="sidebar-link">yarn workspace 管理命令</a></li><li class="sidebar-sub-header"><a href="/luvue/engineering/other/02-lerna+yarn-workspace使用总结.html#yarn-workspace-入门实战" class="sidebar-link">yarn workspace 入门实战</a></li></ul></li></ul></li><li><a href="/luvue/engineering/other/03-pnpm+workspace+changesets构建monorepo工程.html" class="sidebar-link">03-pnpm+workspace+changesets构建monorepo工程</a></li><li><a href="/luvue/engineering/other/04-使用vue3+pnpm从0搭建monorepo项目.html" class="sidebar-link">04-使用vue3+pnpm从0搭建monorepo项目</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/luvue/engineering/rollup/" class="sidebar-heading clickable"><span>rollup</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/luvue/engineering/Tabable/" class="sidebar-heading clickable"><span>Tabable</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/luvue/engineering/Vite/" class="sidebar-heading clickable"><span>Vite</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/luvue/engineering/vue-cli/" class="sidebar-heading clickable"><span>vue-cli</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/luvue/engineering/webpack/" class="sidebar-heading clickable"><span>webpack</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/luvue/engineering/webpack2/" class="sidebar-heading clickable"><span>webpack2</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="lerna-yarn-workspace-使用总结"><a href="#lerna-yarn-workspace-使用总结" class="header-anchor">#</a> lerna + yarn workspace 使用总结</h1> <p></p><div class="table-of-contents"><ul><li><a href="#模式对比">模式对比</a><ul><li><a href="#multirepo">Multirepo</a></li><li><a href="#monorepo">Monorepo</a></li><li><a href="#lerna-yarn-workspace-应用场景">lerna + yarn workspace 应用场景</a></li></ul></li><li><a href="#lerna">Lerna</a><ul><li><a href="#lerna-管理模式">Lerna 管理模式</a></li><li><a href="#lerna-入门指引">Lerna 入门指引</a></li><li><a href="#lerna-管理命令">Lerna 管理命令</a></li><li><a href="#lerna-配置文件">Lerna 配置文件</a></li><li><a href="#lerna-应用-demo">Lerna 应用 Demo</a></li><li><a href="#lerna-版本发布">Lerna 版本发布</a></li><li><a href="#lerna-最佳实践">Lerna 最佳实践</a></li><li><a href="#leran-注意事项">Leran 注意事项</a></li></ul></li><li><a href="#yarn-workspace">yarn workspace</a><ul><li><a href="#yarn-workspace-管理工程">yarn workspace 管理工程</a></li><li><a href="#yarn-workspace-管理命令">yarn workspace 管理命令</a></li><li><a href="#yarn-workspace-入门实战">yarn workspace 入门实战</a></li></ul></li></ul></div><p></p> <p>lerna 管理方式属于 <code>Monorepo</code> 模式，这有别于传统的 <code>Multirepo</code> 单仓库应用模式，下面我们先来了解一下两者的区别。</p> <h2 id="模式对比"><a href="#模式对比" class="header-anchor">#</a> 模式对比</h2> <h3 id="multirepo"><a href="#multirepo" class="header-anchor">#</a> Multirepo</h3> <p>传统的项目开发模式，比如 create-react-app、vue-cli 等框架模板脚手架生成的项目。</p> <ul><li>优点：
<ol><li>各模块管理自由度高；</li> <li>各模块仓库体积一般不会太大；</li></ol></li> <li>缺点
<ol><li>仓库分散不好找，分支管理混乱；</li> <li>版本更新频繁，公共模块版本发生变化，需要对所有模块进行依赖更新；</li></ol></li></ul> <h3 id="monorepo"><a href="#monorepo" class="header-anchor">#</a> Monorepo</h3> <ul><li>优点：
<ol><li>统一的规范、构建工具；</li> <li>方便版本管理和依赖，模块之间的引用调试都变得非常方便；</li> <li>Multirepo 的缺点就是它的优点。</li></ol></li> <li>缺点：
<ol><li>随着应用扩展，仓库体积将变大。</li></ol></li></ul> <h3 id="lerna-yarn-workspace-应用场景"><a href="#lerna-yarn-workspace-应用场景" class="header-anchor">#</a> lerna + yarn workspace 应用场景</h3> <ol><li>作为业务组件库的工程环境搭建。
实现单个业务组件作为单独的 <code>npm</code> 包 进行管理和发布，无需将各个业务组件分开建立在多个 Git 仓库中，且它们的技术栈、构建工具、规范等都可以保持一致。</li> <li>作为日常业务项目工程管理。
比如有一个低代码业务需求，低代码核心工作区的交互都相同，不同的是业务场景（外层壳子和一些定制功能），低代码相关的模块都可以复用，我们只需在这个仓库内不断去扩展业务需求即可，达到核心代码的复用（当然，可能会想到将低代码核心作为线上包）。</li></ol> <h2 id="lerna"><a href="#lerna" class="header-anchor">#</a> Lerna</h2> <p>Lerna 是一个管理工具，用于管理包含多个软件包（package）的 JavaScript 项目，是 Babel 自己用来维护自己的 Monorepo 并开源出的一个项目。</p> <p>它可以：</p> <ul><li>统一的一套规范、构建标准；</li> <li>对相互耦合较大、相互独立的 JS/Git 库进行管理；</li> <li>统一的工作流和 Code Sharing（代码共享）。</li></ul> <p>下面我们从以下几个方面来熟悉 Lerna：</p> <ul><li>Lerna 管理模式；</li> <li>Lerna 入门指引；</li> <li>Lerna 管理命令；</li> <li>Lerna 配置文件；</li> <li>Lerna 应用 Demo；</li> <li>Lerna 版本发布；</li> <li>Lerna 最佳实践；</li> <li>Lerna 注意事项。</li></ul> <h3 id="lerna-管理模式"><a href="#lerna-管理模式" class="header-anchor">#</a> Lerna 管理模式</h3> <p>lerna 管理项目可以使用两种模式，默认固定模式，当使用 <code>lerna init -i</code> 命令初始化项目时，此时为独立模式。（模式是用来管理多个 package 发包时的方式）</p> <ol><li>固定模式：
在发包时会检测 packages 下涉及到变更的包，给这些变更的包使用同一版本，未发生变更的包不应用改版本，且不做发布升级；发布时可通过 lerna publish major（大） | minor（中） | patch （小）自定义版本。</li> <li>独立模式（常用的模式）：
允许每个包有自己独立的版本号，在 lerna publish 发布时，需要为每个改动的库指定版本号（逐个询问需要升级的版本号）。此模式，lerna.json - version 字段指定为 independent。</li></ol> <blockquote><p>如果 packages 下，其中一个包发生改动，另一个包依赖了这个包，即使它没有发生改动，也会被进行发布更新。</p></blockquote> <h3 id="lerna-入门指引"><a href="#lerna-入门指引" class="header-anchor">#</a> Lerna 入门指引</h3> <ol><li>全局安装 Lerna：<div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">npm</span> <span class="token function">install</span> --global lerna
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li>初始化 git 代码仓库：<div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">git</span> init lerna-repo <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> lerna-repo
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li>初始化 Lerna：<div class="language-sh line-numbers-mode"><pre class="language-sh"><code>lerna init
// lerna info Creating package.json
// lerna info Creating lerna.json
// lerna info Creating packages directory
// lerna success Initialized Lerna files
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li>此时得到了这样一个仓库目录结构：<div class="language-sh line-numbers-mode"><pre class="language-sh"><code>lerna-repo/
    packages/
    package.json
    lerna.json
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div>其中 <code>packages</code> 中保存着每个独立的包模块。</li> <li>安装 lerna 到仓库 node_modules 中：<div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">npm</span> <span class="token function">install</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ol> <p>至此，我们就完成了一个 Lerna 工程的初始化工作，下面我们掌握一些操作命令来管理 Lerna。</p> <h3 id="lerna-管理命令"><a href="#lerna-管理命令" class="header-anchor">#</a> Lerna 管理命令</h3> <ol><li><p><code>lerna init</code>
将一个仓库初始化为 lerna 仓库（默认固定模式）。支持参数：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>--independent/-i – 使用独立的版本控制模式
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>lerna create 「package」</code>
创建一个 package 到项目工程的 packages 下。</p></li> <li><p><code>lerna add 「module」</code></p> <ul><li>为每个 package 都安装指定依赖：<div class="language-sh line-numbers-mode"><pre class="language-sh"><code>lerna <span class="token function">add</span> react
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li>为指定的 package 安装特定依赖：<div class="language-sh line-numbers-mode"><pre class="language-sh"><code>lerna <span class="token function">add</span> react-dom packages/package1
// or
lerna <span class="token function">add</span> react-dom --scope<span class="token operator">=</span>package1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li>添加依赖到根目录 node_modules 中：<div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">npm</span> <span class="token function">install</span> typescript -D
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li>package 之间的相互依赖（会在 package/package.json 下添加该依赖）：<div class="language-sh line-numbers-mode"><pre class="language-sh"><code>lerna <span class="token function">add</span> package2 --scope package1
// or
lerna <span class="token function">add</span> package2 packages/package1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ul></li> <li><p><code>lerna publish</code>
用于 npm 包版本发布，具体细节可看下文 「Lerna 版本发布」。</p></li> <li><p><code>lerna bootstrap</code>
用于将 packages 链接在一起(前提是相互依赖的库)，并安装 package 下的依赖到 package/node_modules。</p> <blockquote><p>注意，它不会安装根目录 package.json 的依赖，如果需要安装根目录依赖，请使用 npm install。</p></blockquote> <p>参数：<code>--hoist</code>：依赖提升，把每个 package 下的依赖包都 <code>提升</code> 到工程根目录（删除包下的 node_modules，将依赖安装在根目录，但依赖注册不会在 package/package.json 内删除，也不会在 root/package.json 内添加此依赖）</p></li> <li><p><code>lerna clean</code>
删除各个包下的 node_modules（不会删除根目录 node_modules）。</p></li> <li><p>lerna ls
列出当前 Lerna 仓库中的所有公共软件包（public packages）。</p></li> <li><p><code>lerna run 「script」</code></p> <ul><li>运行每个包下面的 script（如果某个包没有此 script，将会报错）<div class="language-sh line-numbers-mode"><pre class="language-sh"><code>lerna run <span class="token builtin class-name">test</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li>运行某个包下面的 script<div class="language-sh line-numbers-mode"><pre class="language-sh"><code>lerna run <span class="token builtin class-name">test</span> --scope package1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul></li> <li><p><code>lerna exec 「shell」</code>
允许去执行 shell 脚本</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>lerna <span class="token builtin class-name">exec</span> webpack
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>lerna changed</code>
检查自上次发布以来哪些软件包被修改过。</p></li> <li><p><code>lerna link</code>
链接互相引用的库，当 pakcage/package.json 内明确了 packages 下的包时，才会将相关包链接到 package/node_modules 中。</p></li> <li><p><code>lerna info</code>
查看 lerna 及运行环境的信息。</p></li></ol> <h3 id="lerna-配置文件"><a href="#lerna-配置文件" class="header-anchor">#</a> Lerna 配置文件</h3> <p>在 lerna.json 配置文件内可以指定工作模式、packages 的位置以及一些命令的默认参数定义，如下示例：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;npmClient&quot;</span><span class="token operator">:</span> <span class="token string">&quot;yarn&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;useWorkspaces&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">&quot;packages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;packages/*&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;command&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;bootstrap&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;npmClientArgs&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;--no-package-lock&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;publish&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;npmClient&quot;</span><span class="token operator">:</span> <span class="token string">&quot;npm&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;ignoreChanges&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;**/*.md&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;**/test/**&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chore(release): publish&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;registry&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://registry.npmjs.org&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;conventionalCommits&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><ul><li><code>version</code>: 当前仓库的版本，Independent mode 请设置为 independent；</li> <li><code>packages</code>: 指定包所在的目录，支持指定多个目录；</li> <li><code>npmClient</code>: 允许指定命令使用的 client， 默认是 npm， 可以设置成 yarn；</li> <li><code>useWorkspaces</code>: 使用 yarn workspaces 管理 Monorepo；</li> <li><code>command.bootstrap.npmClientArgs</code>: 指定默认传给 lerna bootstrap 命令的参数；</li> <li><code>command.publish.ignoreChanges</code>: 指定那些目录或者文件的变更不用触发 package 版本的变更；</li> <li><code>command.publish.message</code>: 执行发布版本更新时的生成的 commit message；</li> <li><code>command.publish.registry</code>: 指定发布到的 registry url，比如可以发布到指定私服，默认是 npmjs.org；</li> <li><code>command.publish.conventionalCommits</code>: lerna version 将生成 CHANGELOG.md files（如果设置了这个，lerna 管理模式将直接使用固定模式，version = independent 的配置将失效）。</li></ul> <h3 id="lerna-应用-demo"><a href="#lerna-应用-demo" class="header-anchor">#</a> Lerna 应用 Demo</h3> <p>有了上面的基础使用的了解，下面我们通过一个简单 Demo 熟悉一下 Lerna 管理 Packages 的流程方式。</p> <ol><li><p>创建 Lerna 工程：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">git</span> init lerna-demo <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> lerna-demo <span class="token operator">&amp;&amp;</span> lerna init
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>创建两个 package：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>lerna create lerna-module1
lerna create lerna-module2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>在 package 中维护几行测试代码：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// lerna-module1/lib/lerna-module1.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> lernaModule1<span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">lernaModule1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'lerna-module1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// lerna-module2/lib/lerna-module2.js</span>
<span class="token keyword">const</span> lernaModule1 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'lerna-module1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> lernaModule2<span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">lernaModule2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'lerna-module2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">lernaModule1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">lernaModule2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></li> <li><p>在 lerna-module2 下添加一个执行脚本：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// lerna-module2/package.json</span>
<span class="token string">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node ./lib/lerna-module2.js&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>运行脚本：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>lerna run <span class="token builtin class-name">test</span> --scope lerna-module2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>此时会看到终端报错信息：</p> <blockquote><p>Error: Cannot find module 'lerna-module1'</p></blockquote></li> <li><p>手动建立 package 之间的关联：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>lerna <span class="token function">add</span> lerna-module1 --scope lerna-module2
<span class="token comment"># lerna info Adding lerna-module1 in 1 package</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p>此时可以在 lerna-module2 目录下看到生成了 node_modules 文件夹，并且在里面放置了和 lerna-module1 一模一样的包（软链接）。</p></blockquote></li> <li><p>再来执行一次命令：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>lerna run <span class="token builtin class-name">test</span> --scope lerna-module2
终端输出：
lerna-module1
lerna-module2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li></ol> <h3 id="lerna-版本发布"><a href="#lerna-版本发布" class="header-anchor">#</a> Lerna 版本发布</h3> <p>packages 下的包版本发布需要使用 <code>lerna publish</code>，这个命令组合了这两个命令：<code>lerna version</code> 和 <code>npm publish</code>。<br>
其中 lerna version 针对 Lerna 的管理模式（固定模式和独立模式），在表现上有所不同。<br>
但主要工作还是在进行 <code>npm publish</code> 之前，去管理哪些包要进行发布，以及发布过程中生成的 Git commit、Git tag 的提交。</p> <ol><li>固定模式下的 lerna version：
<ul><li>找出从上一个版本发布以来有过<code>变更的 package</code>；</li> <li>根据当前 lerna.json 中的版本<code>生成新的版本号</code>；</li> <li>更新涉及到变更 package 下的 package.json 版本号；</li> <li>更新 lerna.json 文件中的版本号；</li> <li>将 <code>version</code> 更新、生成的 <code>CHANGELOG.md</code> 文件带来的变动提交为一次 commit；</li> <li>基于这次 commit 为所有涉及到更新的 package 打上各自的 tag；</li> <li>推送 commit 和 tags 到远程仓库。</li></ul></li> <li>独立模式下的 lerna version：
<ul><li>找出从上一个版本发布以来有过变更的 package；</li> <li>提示开发者为需要更新的 package 选择（一组 Version Select）要发布的版本号；</li> <li>更新到 package 下的 package.json version 版本号；</li> <li>如果 packages 下其他包有依赖这个包，那么其他包的 package.json 此包版本也会更新；</li> <li>将 version 更新、生成的 CHANGELOG.md 文件带来的变动提交为一次 commit；</li> <li>基于这次 commit 为所有涉及到更新的 package 打上各自的 tag；</li> <li>推送 commit 和 tags 到远程仓库。</li></ul></li></ol> <p>这里需要注意一下 lerna 查找包变更的逻辑：</p> <div class="custom-block tip"><p class="custom-block-title">lerna 查找包变更的逻辑</p> <p>在当前分支，找到最近一次 tag，将当前 commit 和 tag 进行比较，看哪些 package 下的文件发生了变更。</p></div> <p>命令使用如下：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>lerna publish
lerna publish semver
<span class="token comment"># semver bump [major | minor | patch | premajor | preminor | prepatch | prerelease]</span>
lerna publish from <span class="token function">git</span>
lerna publish from-package
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>初次使用发布时可能会遇到以下一些问题和注意事项：</p> <ol><li>避免开发者自己去打 tag。
lerna 发布时会自动生成 tag，并且查找更新是基于 tag 来识别的，避免开发者手动打上 tag 后，影响 lerna 查找变更，可能会造成一些变更包没有按照预期发布。</li> <li>避免多条分支同时进行。
在多条分支同时进行时，可能会生成相同的版本号，从而发生版本冲突。解决办法：分支开发者之前应提前约定好版本。</li> <li>lerna publish 中途发布失败，如何进行重发布。
有时候发布可能会失败（比如 npm 没有登录、没有使用 npmjs 镜像源），再次运行 lerna publish 时，因为 tag 已经打上了，无法再查找到更新，进行包的发布。<br>
可以采用下面两种发布方式：
<ul><li>运行 <code>lerna publish from-git</code>。会将当前标签中涉及的 NPM 包再发布一次。（不会再更新 package.json，只是执行 npm publish）；</li> <li>运行 <code>lerna publish from-package</code>。会将当前所有本地包中的 package.json 和远端 npm 比对，如果 npm 上不存在此包的最新版本，都执行一次 npm publish。</li></ul></li></ol> <h3 id="lerna-最佳实践"><a href="#lerna-最佳实践" class="header-anchor">#</a> Lerna 最佳实践</h3> <p>目前业界使用最多的方案是：<code>lerna + yarm workspace</code> 结合的 <code>Monorepo</code> 方案，两者工作职责划分不同：</p> <ul><li><code>yarn</code> 处理依赖安装工作（只想做好包管理工具）；</li> <li><code>lerna</code> 处理发布流程。</li></ul> <h3 id="leran-注意事项"><a href="#leran-注意事项" class="header-anchor">#</a> Leran 注意事项</h3> <ol><li><p>发布前，提交工作区的变更。
在发布前，需要提交工作区的文件变更，否则终端会收到下面报错信息：</p> <blockquote><p>lerna ERR! EUNCOMMIT Working tree has uncommitted changes, please commit or remove the following changes before continuing:</p></blockquote></li> <li><p>发布前，需使用 npmjs.org 镜像。
在发布前，如果 npm 设置的镜像源为淘宝镜像，需要切换回 npm 镜像：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">npm</span> config get registry
<span class="token function">npm</span> config <span class="token builtin class-name">set</span> registry https://registry.npmjs.org
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>如果要发布一个 Scope 包：
Scope 是指具有“组织”的包，比如 Babel 的相关包都是这一格式：@babel/xxx，在发布一个具有 Scope 包时，需要确保 Organization（组织）已在 npm 上创建，私有包需要收费，公共包则为免费。<br>
在发布 Scope package 时，需要在 package.json 声明 access publish：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;@feu/tools&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;publishConfig&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;access&quot;</span><span class="token operator">:</span> <span class="token string">&quot;publish&quot;</span> <span class="token comment">// 如果该模块需要发布，对于 scope 模块，需要设置为 publish</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p>发布意外中断，进行重发布：
如果发布因为某些原因中断了，未发布成功，再次执行发布，会得到如下提示：</p> <blockquote><p>lerna success No changed packages to publish</p></blockquote> <p>但由于包并未成功发布到 npmjs 上，这时可以执行以下命令进行重发布：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>lerna publish from-git
<span class="token comment"># or</span>
lerna publish from-package
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>independent 模式并未生效：
在 lerna.json 下指定了 version 为 independent，但是发布时却还是固定模式的流程，原因可能是 lerna.json 内配置了 <code>conventionalCommits</code>：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;command&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;publish&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;conventionalCommits&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>可以将其配置移除得到解决。</p></li> <li><p>固定模式如何自己指定版本：
当我们执行 lerna publish 时，lerna 会<code>自定分配一个版本</code>提供我们使用；但这个版本可能不是我们期望发布的版本；如何自己控制发布的版本呢，在发布时我们可以传递配置：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>lerna publish major（大） <span class="token operator">|</span> minor（中） <span class="token operator">|</span> patch （小）
lerna publish patch <span class="token comment"># 发布小版本</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ol> <h2 id="yarn-workspace"><a href="#yarn-workspace" class="header-anchor">#</a> yarn workspace</h2> <p>对于 <code>Monorepo</code> 的工程，使用最多的方式是 <code>lerna</code> 结合 <code>yarn workspace</code> 一起使用。<br>
因为 <code>yarn</code> 在依赖管理上做的非常不错，适合我们业务场景的依赖模块管理。<br>
而 package 的发布工作依旧交由 <code>lerna publish</code> 来运转。</p> <p>下面我们从以下几个方面来熟悉 yarn workspace：</p> <ul><li>yarn workspace 管理工程；</li> <li>yarn workspace 管理命令；</li> <li>yarn workspace 入门实战。</li></ul> <h3 id="yarn-workspace-管理工程"><a href="#yarn-workspace-管理工程" class="header-anchor">#</a> yarn workspace 管理工程</h3> <p>初始化工程的步骤和上面 <code>lerna</code> 的方式一样，与 lerna 不同的是，需要做以下配置：</p> <ol><li>在 lerna.json 中声明使用 <code>yarn workspace</code> 进行依赖管理：<div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  ...
  <span class="token property">&quot;npmClient&quot;</span><span class="token operator">:</span> <span class="token string">&quot;yarn&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;useWorkspaces&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li>在 <code>root/package.json</code> 下必需包含 <code>workspaces</code> 数组，与 <code>lerna.json</code> 下的 <code>packages</code> 保持一致：<div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;private&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 工作空间不需要发布</span>
  <span class="token operator">...</span>
  <span class="token string">&quot;workspaces&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;packages/*&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li></ol> <h3 id="yarn-workspace-管理命令"><a href="#yarn-workspace-管理命令" class="header-anchor">#</a> yarn workspace 管理命令</h3> <p>yarn 管理命令大致分为两类（容易混淆，这里先提及一下）：</p> <ul><li>处理工程下指定的包模块时使用：<code>yarn workspace</code>；</li> <li>处理工程根目录全局或所有包模块时使用：<code>yarn workspaces</code>。</li></ul> <ol><li><p><code>yarn install</code>
代替 <code>npm install + lerna bootstrap</code> 安装工程依赖。</p> <p>它与 lerna bootstarp 不同的是：</p> <ul><li><code>yarn install</code> 会将 <code>package</code> 下的依赖<code>统一安装到根目录之下</code>。这有利于提升依赖的安装效率和不同 package 间的版本复用（有些包是需要私有依赖的，而私有依赖会被多个包安装多次，而提升依赖可以解决这一问题）。</li> <li>yarn install 会自动帮助解决安装（包括根目录下的安装）和 packages link 问题。</li></ul></li> <li><p><code>yarn add 「module」</code></p> <ul><li>为每个 package 都安装指定依赖：<div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">yarn</span> workspaces <span class="token function">add</span> react
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li>为指定的 package 安装特定依赖：<div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">yarn</span> workspace package1 <span class="token function">add</span> react react-dom --save
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>注意，package1 一定是 packages/package1/package.json name 字段，有时候 package 的目录名和 name 字段不一致，要以 name 为准。</p></blockquote></li> <li>添加依赖到根目录 node_modules 中：<div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token builtin class-name">cd</span> 根目录
<span class="token function">yarn</span> <span class="token function">add</span> @babel/core -D -W （-W 表示将依赖添加到 workspaces 根目录）
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li>package 之间的相互依赖（会在 package/package.json 下添加该依赖）：<div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">yarn</span> workspace package1 <span class="token function">add</span> package2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>注意，当 package2 没有发布在 npmjs 上时，此时会报错：package2 not found；解决办法：显示指定 package2 的版本： yarn workspace package1 add package2@^1.0.0</p></blockquote></li> <li>在工程根目录下引入 packages/package 包：<div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">yarn</span> <span class="token function">add</span> package@^1.0.0 -W
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul></li> <li><p><code>yarn remove「module」</code>
和上面 yarn add 命令格式相同，只需将 add 替换为 remove 即可。</p></li> <li><p><code>yarn run 「script」</code></p> <ul><li>运行工程根目录下 script：<div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">yarn</span> <span class="token builtin class-name">test</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li>运行指定包模块下的 script：<div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">yarn</span> workspace package1 run <span class="token builtin class-name">test</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>值得注意的是，命令虽然是在根目录下执行，但在执行文件中拿到的 <code>process.cwd()</code> 是 <code>package</code> 下的执行文件所在路径</p></blockquote></li> <li>运行所有 package 下的 script 命令：<div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">yarn</span> workspaces run <span class="token builtin class-name">test</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>注意，如果某个 package 下没有对应 script，将会终止命令，并报错。若 package 不具备 script，可以定义一个占位 script，类似如下：</p></blockquote> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;lint&quot;</span><span class="token operator">:</span> <span class="token string">&quot;echo lint successful.&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ul></li> <li><p><code>yarn workspaces info</code>
查看 workspace 依赖树信息。</p></li></ol> <h3 id="yarn-workspace-入门实战"><a href="#yarn-workspace-入门实战" class="header-anchor">#</a> yarn workspace 入门实战</h3> <ol><li><p>新建 yarn workspace 工程：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">git</span> init yarn-demo <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> yarn-demo <span class="token operator">&amp;&amp;</span> <span class="token function">yarn</span> init -y <span class="token operator">&amp;&amp;</span> <span class="token function">yarn</span> <span class="token function">add</span> lerna -D <span class="token operator">&amp;&amp;</span> lerna init
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>配置 lerna.json 改用 yarn workspaces：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token comment">// lerna.json</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;npmClient&quot;</span><span class="token operator">:</span> <span class="token string">&quot;yarn&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;useWorkspaces&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">&quot;packages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;packages/*&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;independent&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>根目录 package.json 必须包含一个 workspaces 数组:</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;private&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 工作空间不需要发布</span>
  <span class="token property">&quot;workspaces&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;packages/*&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  ...
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>新建两个 package：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token builtin class-name">cd</span> packages <span class="token operator">&amp;&amp;</span> <span class="token function">mkdir</span> yarn-module1 <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> yarn-module1 <span class="token operator">&amp;&amp;</span> <span class="token function">yarn</span> init -y
<span class="token builtin class-name">cd</span> packages <span class="token operator">&amp;&amp;</span> <span class="token function">mkdir</span> yarn-module2 <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> yarn-module2 <span class="token operator">&amp;&amp;</span> <span class="token function">yarn</span> init -y
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>添加几行测试代码：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// yarn-module1/index.js</span>
<span class="token keyword">function</span> <span class="token function">yarnModule1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'yarn-module1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> yarnModule1<span class="token punctuation">;</span>

<span class="token comment">// yarn-module2/index.js</span>
<span class="token keyword">const</span> yarnModule1 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'yarn-module1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">yarnModule2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'yarn-module2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">yarnModule1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">yarnModule2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> yarnModule2<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div></li> <li><p>为 yarn-module2 添加个 script：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token comment">// yarn-module2/package.json</span>
<span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node index.js&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>回到根目录执行 script：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">yarn</span> workspace yarn-module2 run <span class="token builtin class-name">test</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>不出意外，会得到如下错误：</p> <blockquote><p>Error: Cannot find module 'yarn-module1'</p></blockquote></li> <li><p>建立 package 之间的关系：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">yarn</span> <span class="token function">install</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>可以看到，根目录下的 node_modules 中已经存在了 yarn-module1 和 yarn-module2 这两个包，与 lerna 的区别在于没有在各自的 package 下创建 node_modules，而是统一链接到根目录。<br>
但，<code>yarn-module2</code> 中依赖的 <code>yarn-module1</code>，应该将其添加到 package.json 中，最好的方式是采用</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">yarn</span> workspace yarn-module2 <span class="token function">add</span> yarn-module1@^1.0.0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>再来一次 script：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">yarn</span> workspace yarn-module2 run <span class="token builtin class-name">test</span>

输出：
yarn-module1
yarn-module2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/luvue/engineering/other/01-浏览器渲染原理与性能优化.html" class="prev">01-浏览器渲染原理与性能优化</a></span> <span class="next"><a href="/luvue/engineering/other/03-pnpm+workspace+changesets构建monorepo工程.html">03-pnpm+workspace+changesets构建monorepo工程</a>
      →
    </span></p></div> </main> <span data-v-2ae0ee72></span></div><div class="global-ui"></div></div>
    <script src="/luvue/assets/js/app.50227b6d.js" defer></script><script src="/luvue/assets/js/2.dc297d8e.js" defer></script><script src="/luvue/assets/js/3.51a2d233.js" defer></script><script src="/luvue/assets/js/57.97fdefbb.js" defer></script>
  </body>
</html>
