<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>lerna + yarn workspace 使用总结 | Ailjc notes</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel=" " href=" ">
    <meta name="description" content=" ">
    
    <link rel="preload" href="/luvue/assets/css/0.styles.0c275c11.css" as="style"><link rel="preload" href="/luvue/assets/js/app.24d3cb9c.js" as="script"><link rel="preload" href="/luvue/assets/js/2.7e9a2be9.js" as="script"><link rel="preload" href="/luvue/assets/js/3.92ecc592.js" as="script"><link rel="preload" href="/luvue/assets/js/56.a651fa0f.js" as="script"><link rel="prefetch" href="/luvue/assets/js/10.fefd87d0.js"><link rel="prefetch" href="/luvue/assets/js/100.19a916cd.js"><link rel="prefetch" href="/luvue/assets/js/101.15e09ebc.js"><link rel="prefetch" href="/luvue/assets/js/102.8c2aa751.js"><link rel="prefetch" href="/luvue/assets/js/103.80aaf15e.js"><link rel="prefetch" href="/luvue/assets/js/104.4b17369d.js"><link rel="prefetch" href="/luvue/assets/js/105.e3b99d7f.js"><link rel="prefetch" href="/luvue/assets/js/106.6cb53770.js"><link rel="prefetch" href="/luvue/assets/js/107.0faf8906.js"><link rel="prefetch" href="/luvue/assets/js/108.695346d6.js"><link rel="prefetch" href="/luvue/assets/js/109.438c6b2e.js"><link rel="prefetch" href="/luvue/assets/js/11.141d84f1.js"><link rel="prefetch" href="/luvue/assets/js/110.6ffb0399.js"><link rel="prefetch" href="/luvue/assets/js/111.61fd8319.js"><link rel="prefetch" href="/luvue/assets/js/112.9998d3be.js"><link rel="prefetch" href="/luvue/assets/js/113.89ee7c2f.js"><link rel="prefetch" href="/luvue/assets/js/114.b21dd215.js"><link rel="prefetch" href="/luvue/assets/js/115.e5ecdcf4.js"><link rel="prefetch" href="/luvue/assets/js/116.5ca6e10a.js"><link rel="prefetch" href="/luvue/assets/js/117.44d630a9.js"><link rel="prefetch" href="/luvue/assets/js/118.3a710062.js"><link rel="prefetch" href="/luvue/assets/js/119.00b1d4d9.js"><link rel="prefetch" href="/luvue/assets/js/12.2730a5bc.js"><link rel="prefetch" href="/luvue/assets/js/120.f785e761.js"><link rel="prefetch" href="/luvue/assets/js/121.021c6306.js"><link rel="prefetch" href="/luvue/assets/js/122.e0bf3cfc.js"><link rel="prefetch" href="/luvue/assets/js/123.01466def.js"><link rel="prefetch" href="/luvue/assets/js/124.2dcfea2f.js"><link rel="prefetch" href="/luvue/assets/js/125.41167849.js"><link rel="prefetch" href="/luvue/assets/js/126.5d739372.js"><link rel="prefetch" href="/luvue/assets/js/127.f56f652e.js"><link rel="prefetch" href="/luvue/assets/js/128.40b9b278.js"><link rel="prefetch" href="/luvue/assets/js/129.207137ba.js"><link rel="prefetch" href="/luvue/assets/js/13.60de938c.js"><link rel="prefetch" href="/luvue/assets/js/130.db104c86.js"><link rel="prefetch" href="/luvue/assets/js/131.2c9e9b26.js"><link rel="prefetch" href="/luvue/assets/js/132.d3d980cb.js"><link rel="prefetch" href="/luvue/assets/js/133.aa1a804e.js"><link rel="prefetch" href="/luvue/assets/js/134.231966e7.js"><link rel="prefetch" href="/luvue/assets/js/135.2dbcd9a0.js"><link rel="prefetch" href="/luvue/assets/js/136.919530da.js"><link rel="prefetch" href="/luvue/assets/js/137.c703c0a8.js"><link rel="prefetch" href="/luvue/assets/js/138.d0fbe76a.js"><link rel="prefetch" href="/luvue/assets/js/139.d6ceef15.js"><link rel="prefetch" href="/luvue/assets/js/14.1bd46c2e.js"><link rel="prefetch" href="/luvue/assets/js/140.5ed92165.js"><link rel="prefetch" href="/luvue/assets/js/141.916b71f0.js"><link rel="prefetch" href="/luvue/assets/js/142.27fd2bd5.js"><link rel="prefetch" href="/luvue/assets/js/143.6ada4af5.js"><link rel="prefetch" href="/luvue/assets/js/144.bd6f10eb.js"><link rel="prefetch" href="/luvue/assets/js/145.10c93542.js"><link rel="prefetch" href="/luvue/assets/js/146.038104a3.js"><link rel="prefetch" href="/luvue/assets/js/147.ef6ffd68.js"><link rel="prefetch" href="/luvue/assets/js/148.7d62ecb5.js"><link rel="prefetch" href="/luvue/assets/js/149.ae6c8e49.js"><link rel="prefetch" href="/luvue/assets/js/15.8a053615.js"><link rel="prefetch" href="/luvue/assets/js/150.5350b1a8.js"><link rel="prefetch" href="/luvue/assets/js/151.1f9fee8b.js"><link rel="prefetch" href="/luvue/assets/js/152.e6e676be.js"><link rel="prefetch" href="/luvue/assets/js/153.068ed172.js"><link rel="prefetch" href="/luvue/assets/js/154.3c4d0eb6.js"><link rel="prefetch" href="/luvue/assets/js/155.f99df381.js"><link rel="prefetch" href="/luvue/assets/js/156.537a2efd.js"><link rel="prefetch" href="/luvue/assets/js/157.0acfc338.js"><link rel="prefetch" href="/luvue/assets/js/158.26d3338f.js"><link rel="prefetch" href="/luvue/assets/js/159.6f1cc4e1.js"><link rel="prefetch" href="/luvue/assets/js/16.7f7a3ee8.js"><link rel="prefetch" href="/luvue/assets/js/160.5bd2b3df.js"><link rel="prefetch" href="/luvue/assets/js/161.f50a7be4.js"><link rel="prefetch" href="/luvue/assets/js/162.4846c312.js"><link rel="prefetch" href="/luvue/assets/js/163.3d6f75ae.js"><link rel="prefetch" href="/luvue/assets/js/164.cf7094e1.js"><link rel="prefetch" href="/luvue/assets/js/165.b084c14e.js"><link rel="prefetch" href="/luvue/assets/js/166.d91162ba.js"><link rel="prefetch" href="/luvue/assets/js/167.69358e95.js"><link rel="prefetch" href="/luvue/assets/js/168.0b12410a.js"><link rel="prefetch" href="/luvue/assets/js/169.91d22f58.js"><link rel="prefetch" href="/luvue/assets/js/17.6a766300.js"><link rel="prefetch" href="/luvue/assets/js/170.c3c7e2cd.js"><link rel="prefetch" href="/luvue/assets/js/171.33dd8106.js"><link rel="prefetch" href="/luvue/assets/js/172.af5c5706.js"><link rel="prefetch" href="/luvue/assets/js/173.5d6b421f.js"><link rel="prefetch" href="/luvue/assets/js/174.6c53f57e.js"><link rel="prefetch" href="/luvue/assets/js/175.737dc55c.js"><link rel="prefetch" href="/luvue/assets/js/176.55b0940c.js"><link rel="prefetch" href="/luvue/assets/js/177.c88610d7.js"><link rel="prefetch" href="/luvue/assets/js/178.5858fe0b.js"><link rel="prefetch" href="/luvue/assets/js/179.9125a0ca.js"><link rel="prefetch" href="/luvue/assets/js/18.ceac0c46.js"><link rel="prefetch" href="/luvue/assets/js/180.3e38599d.js"><link rel="prefetch" href="/luvue/assets/js/181.25c2e254.js"><link rel="prefetch" href="/luvue/assets/js/182.80fa8809.js"><link rel="prefetch" href="/luvue/assets/js/183.da1b5a2b.js"><link rel="prefetch" href="/luvue/assets/js/184.acba5e76.js"><link rel="prefetch" href="/luvue/assets/js/185.eaf51d55.js"><link rel="prefetch" href="/luvue/assets/js/186.8de639f8.js"><link rel="prefetch" href="/luvue/assets/js/187.a02bfc44.js"><link rel="prefetch" href="/luvue/assets/js/188.5f5aac79.js"><link rel="prefetch" href="/luvue/assets/js/189.5e8eaa5e.js"><link rel="prefetch" href="/luvue/assets/js/19.82af8a5d.js"><link rel="prefetch" href="/luvue/assets/js/190.6e3dd61d.js"><link rel="prefetch" href="/luvue/assets/js/191.ff42b9b7.js"><link rel="prefetch" href="/luvue/assets/js/192.133d06c7.js"><link rel="prefetch" href="/luvue/assets/js/193.64fba768.js"><link rel="prefetch" href="/luvue/assets/js/194.660335c7.js"><link rel="prefetch" href="/luvue/assets/js/195.9f6cae6d.js"><link rel="prefetch" href="/luvue/assets/js/196.586e8911.js"><link rel="prefetch" href="/luvue/assets/js/197.9c1be23d.js"><link rel="prefetch" href="/luvue/assets/js/198.95b7d4ed.js"><link rel="prefetch" href="/luvue/assets/js/199.3844e818.js"><link rel="prefetch" href="/luvue/assets/js/20.c59106ba.js"><link rel="prefetch" href="/luvue/assets/js/200.ef447f95.js"><link rel="prefetch" href="/luvue/assets/js/201.10481b4c.js"><link rel="prefetch" href="/luvue/assets/js/202.8b3925fe.js"><link rel="prefetch" href="/luvue/assets/js/203.8e740ff3.js"><link rel="prefetch" href="/luvue/assets/js/204.10e0ff19.js"><link rel="prefetch" href="/luvue/assets/js/205.aa8b64c3.js"><link rel="prefetch" href="/luvue/assets/js/206.5cadd5e0.js"><link rel="prefetch" href="/luvue/assets/js/207.1c3fb502.js"><link rel="prefetch" href="/luvue/assets/js/208.37e57586.js"><link rel="prefetch" href="/luvue/assets/js/209.b251f57c.js"><link rel="prefetch" href="/luvue/assets/js/21.dbcb08ca.js"><link rel="prefetch" href="/luvue/assets/js/210.f4c69350.js"><link rel="prefetch" href="/luvue/assets/js/211.a60ef32b.js"><link rel="prefetch" href="/luvue/assets/js/212.5df085a0.js"><link rel="prefetch" href="/luvue/assets/js/213.6cca02ed.js"><link rel="prefetch" href="/luvue/assets/js/214.e437f7ba.js"><link rel="prefetch" href="/luvue/assets/js/215.9731e93e.js"><link rel="prefetch" href="/luvue/assets/js/216.be0f0876.js"><link rel="prefetch" href="/luvue/assets/js/217.36c30f83.js"><link rel="prefetch" href="/luvue/assets/js/218.680c6053.js"><link rel="prefetch" href="/luvue/assets/js/219.d01d0032.js"><link rel="prefetch" href="/luvue/assets/js/22.6382f403.js"><link rel="prefetch" href="/luvue/assets/js/220.5ca1be98.js"><link rel="prefetch" href="/luvue/assets/js/221.a6371702.js"><link rel="prefetch" href="/luvue/assets/js/222.db815fbb.js"><link rel="prefetch" href="/luvue/assets/js/223.db9037a7.js"><link rel="prefetch" href="/luvue/assets/js/224.23cd9e02.js"><link rel="prefetch" href="/luvue/assets/js/225.45220dd3.js"><link rel="prefetch" href="/luvue/assets/js/226.0b9b7a79.js"><link rel="prefetch" href="/luvue/assets/js/227.0eaaaaf4.js"><link rel="prefetch" href="/luvue/assets/js/228.382e9e0e.js"><link rel="prefetch" href="/luvue/assets/js/229.3ae1b558.js"><link rel="prefetch" href="/luvue/assets/js/23.c6b6dae9.js"><link rel="prefetch" href="/luvue/assets/js/230.d4487ee4.js"><link rel="prefetch" href="/luvue/assets/js/231.f2163054.js"><link rel="prefetch" href="/luvue/assets/js/232.df938b18.js"><link rel="prefetch" href="/luvue/assets/js/233.9330e97c.js"><link rel="prefetch" href="/luvue/assets/js/234.cc4ebd06.js"><link rel="prefetch" href="/luvue/assets/js/235.a222b8e0.js"><link rel="prefetch" href="/luvue/assets/js/236.25768542.js"><link rel="prefetch" href="/luvue/assets/js/237.38e66e45.js"><link rel="prefetch" href="/luvue/assets/js/238.55b39563.js"><link rel="prefetch" href="/luvue/assets/js/239.ae76877e.js"><link rel="prefetch" href="/luvue/assets/js/24.d1d8ef7c.js"><link rel="prefetch" href="/luvue/assets/js/240.924c3283.js"><link rel="prefetch" href="/luvue/assets/js/241.bcfcb6f8.js"><link rel="prefetch" href="/luvue/assets/js/242.7221bb51.js"><link rel="prefetch" href="/luvue/assets/js/243.19be8d64.js"><link rel="prefetch" href="/luvue/assets/js/244.b0ab537d.js"><link rel="prefetch" href="/luvue/assets/js/245.c9903538.js"><link rel="prefetch" href="/luvue/assets/js/246.7c7b2b9c.js"><link rel="prefetch" href="/luvue/assets/js/247.773b9f34.js"><link rel="prefetch" href="/luvue/assets/js/248.094da9b6.js"><link rel="prefetch" href="/luvue/assets/js/249.2c6cf0c1.js"><link rel="prefetch" href="/luvue/assets/js/25.541ff376.js"><link rel="prefetch" href="/luvue/assets/js/250.fb1d17fd.js"><link rel="prefetch" href="/luvue/assets/js/251.fcc04c86.js"><link rel="prefetch" href="/luvue/assets/js/252.3a8d2b0b.js"><link rel="prefetch" href="/luvue/assets/js/253.6225bd1a.js"><link rel="prefetch" href="/luvue/assets/js/254.9d4efc27.js"><link rel="prefetch" href="/luvue/assets/js/255.84f219e2.js"><link rel="prefetch" href="/luvue/assets/js/256.dce304d6.js"><link rel="prefetch" href="/luvue/assets/js/257.597148bd.js"><link rel="prefetch" href="/luvue/assets/js/258.86361cde.js"><link rel="prefetch" href="/luvue/assets/js/259.f963bf59.js"><link rel="prefetch" href="/luvue/assets/js/26.aa800826.js"><link rel="prefetch" href="/luvue/assets/js/260.3a2b7c24.js"><link rel="prefetch" href="/luvue/assets/js/261.8b31c343.js"><link rel="prefetch" href="/luvue/assets/js/262.9bc9b4ed.js"><link rel="prefetch" href="/luvue/assets/js/263.cf027585.js"><link rel="prefetch" href="/luvue/assets/js/264.fdd59d42.js"><link rel="prefetch" href="/luvue/assets/js/265.92a6c3e1.js"><link rel="prefetch" href="/luvue/assets/js/266.6dff3d79.js"><link rel="prefetch" href="/luvue/assets/js/267.748610ba.js"><link rel="prefetch" href="/luvue/assets/js/268.7403658e.js"><link rel="prefetch" href="/luvue/assets/js/269.b06f9631.js"><link rel="prefetch" href="/luvue/assets/js/27.234a1646.js"><link rel="prefetch" href="/luvue/assets/js/270.7b4756b5.js"><link rel="prefetch" href="/luvue/assets/js/271.555a52f0.js"><link rel="prefetch" href="/luvue/assets/js/272.d7885b5c.js"><link rel="prefetch" href="/luvue/assets/js/273.f2233d66.js"><link rel="prefetch" href="/luvue/assets/js/274.723b3e19.js"><link rel="prefetch" href="/luvue/assets/js/275.4048adb4.js"><link rel="prefetch" href="/luvue/assets/js/276.2f1e1578.js"><link rel="prefetch" href="/luvue/assets/js/277.cbba2bac.js"><link rel="prefetch" href="/luvue/assets/js/278.53995e86.js"><link rel="prefetch" href="/luvue/assets/js/279.4f6ccf8b.js"><link rel="prefetch" href="/luvue/assets/js/28.f5cb3cd0.js"><link rel="prefetch" href="/luvue/assets/js/280.673b10f1.js"><link rel="prefetch" href="/luvue/assets/js/281.c68eaa9d.js"><link rel="prefetch" href="/luvue/assets/js/282.daf11127.js"><link rel="prefetch" href="/luvue/assets/js/283.f9098504.js"><link rel="prefetch" href="/luvue/assets/js/284.6e81376b.js"><link rel="prefetch" href="/luvue/assets/js/285.0886b889.js"><link rel="prefetch" href="/luvue/assets/js/286.fac16ac5.js"><link rel="prefetch" href="/luvue/assets/js/287.06875def.js"><link rel="prefetch" href="/luvue/assets/js/288.f1c3ab86.js"><link rel="prefetch" href="/luvue/assets/js/289.5fa60820.js"><link rel="prefetch" href="/luvue/assets/js/29.d66372db.js"><link rel="prefetch" href="/luvue/assets/js/290.30e32d07.js"><link rel="prefetch" href="/luvue/assets/js/291.ba2fabdb.js"><link rel="prefetch" href="/luvue/assets/js/292.1e88c8f2.js"><link rel="prefetch" href="/luvue/assets/js/293.46d9f2af.js"><link rel="prefetch" href="/luvue/assets/js/294.9e9e9a97.js"><link rel="prefetch" href="/luvue/assets/js/295.51089eeb.js"><link rel="prefetch" href="/luvue/assets/js/296.e3aa873c.js"><link rel="prefetch" href="/luvue/assets/js/297.80bbdcce.js"><link rel="prefetch" href="/luvue/assets/js/298.5a37e3df.js"><link rel="prefetch" href="/luvue/assets/js/299.6cc42bda.js"><link rel="prefetch" href="/luvue/assets/js/30.dc058ead.js"><link rel="prefetch" href="/luvue/assets/js/300.607335b0.js"><link rel="prefetch" href="/luvue/assets/js/301.395651cb.js"><link rel="prefetch" href="/luvue/assets/js/302.4d29a7f4.js"><link rel="prefetch" href="/luvue/assets/js/31.023e058b.js"><link rel="prefetch" href="/luvue/assets/js/32.c38eba45.js"><link rel="prefetch" href="/luvue/assets/js/33.96ae807e.js"><link rel="prefetch" href="/luvue/assets/js/34.e0ca9d9d.js"><link rel="prefetch" href="/luvue/assets/js/35.1ef08ee2.js"><link rel="prefetch" href="/luvue/assets/js/36.9f317212.js"><link rel="prefetch" href="/luvue/assets/js/37.4edf1dd8.js"><link rel="prefetch" href="/luvue/assets/js/38.16c29e38.js"><link rel="prefetch" href="/luvue/assets/js/39.2a932be2.js"><link rel="prefetch" href="/luvue/assets/js/4.0b4fc096.js"><link rel="prefetch" href="/luvue/assets/js/40.82cb02c3.js"><link rel="prefetch" href="/luvue/assets/js/41.12394088.js"><link rel="prefetch" href="/luvue/assets/js/42.d2fa2e92.js"><link rel="prefetch" href="/luvue/assets/js/43.1cb4fd05.js"><link rel="prefetch" href="/luvue/assets/js/44.66674ed7.js"><link rel="prefetch" href="/luvue/assets/js/45.eb01a397.js"><link rel="prefetch" href="/luvue/assets/js/46.c87680a3.js"><link rel="prefetch" href="/luvue/assets/js/47.3b88dbdc.js"><link rel="prefetch" href="/luvue/assets/js/48.f9343fda.js"><link rel="prefetch" href="/luvue/assets/js/49.ac55888f.js"><link rel="prefetch" href="/luvue/assets/js/5.768ccd03.js"><link rel="prefetch" href="/luvue/assets/js/50.f7b99ab4.js"><link rel="prefetch" href="/luvue/assets/js/51.adbf4796.js"><link rel="prefetch" href="/luvue/assets/js/52.2f534912.js"><link rel="prefetch" href="/luvue/assets/js/53.cc8c809f.js"><link rel="prefetch" href="/luvue/assets/js/54.386d731a.js"><link rel="prefetch" href="/luvue/assets/js/55.3f6022b7.js"><link rel="prefetch" href="/luvue/assets/js/57.e4dcd280.js"><link rel="prefetch" href="/luvue/assets/js/58.ccf3ec02.js"><link rel="prefetch" href="/luvue/assets/js/59.b9647de8.js"><link rel="prefetch" href="/luvue/assets/js/6.ac3e0798.js"><link rel="prefetch" href="/luvue/assets/js/60.93806c99.js"><link rel="prefetch" href="/luvue/assets/js/61.89498686.js"><link rel="prefetch" href="/luvue/assets/js/62.15faac6d.js"><link rel="prefetch" href="/luvue/assets/js/63.9d855c5d.js"><link rel="prefetch" href="/luvue/assets/js/64.ba1547e2.js"><link rel="prefetch" href="/luvue/assets/js/65.90372937.js"><link rel="prefetch" href="/luvue/assets/js/66.42c645cb.js"><link rel="prefetch" href="/luvue/assets/js/67.fc7bf953.js"><link rel="prefetch" href="/luvue/assets/js/68.b048c6f4.js"><link rel="prefetch" href="/luvue/assets/js/69.cd1ca1b0.js"><link rel="prefetch" href="/luvue/assets/js/7.0c495c55.js"><link rel="prefetch" href="/luvue/assets/js/70.de796229.js"><link rel="prefetch" href="/luvue/assets/js/71.79fbccd7.js"><link rel="prefetch" href="/luvue/assets/js/72.ef920547.js"><link rel="prefetch" href="/luvue/assets/js/73.7aad1269.js"><link rel="prefetch" href="/luvue/assets/js/74.70e82141.js"><link rel="prefetch" href="/luvue/assets/js/75.7c695c09.js"><link rel="prefetch" href="/luvue/assets/js/76.ebb5ed1a.js"><link rel="prefetch" href="/luvue/assets/js/77.1b4696ba.js"><link rel="prefetch" href="/luvue/assets/js/78.17fbd9e8.js"><link rel="prefetch" href="/luvue/assets/js/79.347e97c2.js"><link rel="prefetch" href="/luvue/assets/js/8.3505ba5a.js"><link rel="prefetch" href="/luvue/assets/js/80.a68ac880.js"><link rel="prefetch" href="/luvue/assets/js/81.29697f3f.js"><link rel="prefetch" href="/luvue/assets/js/82.19ca69f9.js"><link rel="prefetch" href="/luvue/assets/js/83.46ead34f.js"><link rel="prefetch" href="/luvue/assets/js/84.e67d55b4.js"><link rel="prefetch" href="/luvue/assets/js/85.9d228e88.js"><link rel="prefetch" href="/luvue/assets/js/86.43b52482.js"><link rel="prefetch" href="/luvue/assets/js/87.a3a73d27.js"><link rel="prefetch" href="/luvue/assets/js/88.f1caa267.js"><link rel="prefetch" href="/luvue/assets/js/89.1e0c098e.js"><link rel="prefetch" href="/luvue/assets/js/9.65549bfc.js"><link rel="prefetch" href="/luvue/assets/js/90.814a1362.js"><link rel="prefetch" href="/luvue/assets/js/91.604291e4.js"><link rel="prefetch" href="/luvue/assets/js/92.f66726d9.js"><link rel="prefetch" href="/luvue/assets/js/93.46431418.js"><link rel="prefetch" href="/luvue/assets/js/94.c9f65d27.js"><link rel="prefetch" href="/luvue/assets/js/95.9217bd28.js"><link rel="prefetch" href="/luvue/assets/js/96.72450da7.js"><link rel="prefetch" href="/luvue/assets/js/97.1e48a1d5.js"><link rel="prefetch" href="/luvue/assets/js/98.b5889720.js"><link rel="prefetch" href="/luvue/assets/js/99.2635376c.js">
    <link rel="stylesheet" href="/luvue/assets/css/0.styles.0c275c11.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/luvue/" class="home-link router-link-active"><!----> <span class="site-name">Ailjc notes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/luvue/" class="nav-link">首页</a></div><div class="nav-item"><a href="/luvue/Js/" class="nav-link">Js</a></div><div class="nav-item"><a href="/luvue/react/" class="nav-link">React</a></div><div class="nav-item"><a href="/luvue/vuebase/" class="nav-link">快速掌握Vue</a></div><div class="nav-item"><a href="/luvue/node/" class="nav-link">Node</a></div><div class="nav-item"><a href="/luvue/typescript/" class="nav-link">Typescript</a></div><div class="nav-item"><a href="/luvue/vue3/" class="nav-link">Vue3</a></div><div class="nav-item"><a href="/luvue/vuesourcecode/" class="nav-link">源码分析</a></div><div class="nav-item"><a href="/luvue/lu-ui/" class="nav-link">组件库</a></div><div class="nav-item"><a href="/luvue/engineering/" class="nav-link router-link-active">工程化</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/luvue/" class="nav-link">首页</a></div><div class="nav-item"><a href="/luvue/Js/" class="nav-link">Js</a></div><div class="nav-item"><a href="/luvue/react/" class="nav-link">React</a></div><div class="nav-item"><a href="/luvue/vuebase/" class="nav-link">快速掌握Vue</a></div><div class="nav-item"><a href="/luvue/node/" class="nav-link">Node</a></div><div class="nav-item"><a href="/luvue/typescript/" class="nav-link">Typescript</a></div><div class="nav-item"><a href="/luvue/vue3/" class="nav-link">Vue3</a></div><div class="nav-item"><a href="/luvue/vuesourcecode/" class="nav-link">源码分析</a></div><div class="nav-item"><a href="/luvue/lu-ui/" class="nav-link">组件库</a></div><div class="nav-item"><a href="/luvue/engineering/" class="nav-link router-link-active">工程化</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/luvue/engineering/Loader/" class="sidebar-heading clickable"><span>Loader</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/luvue/engineering/Tabable/" class="sidebar-heading clickable"><span>Tabable</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/luvue/engineering/Vite/" class="sidebar-heading clickable"><span>Vite</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/luvue/engineering/babel/" class="sidebar-heading clickable"><span>babel</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/luvue/engineering/other/" class="sidebar-heading clickable router-link-active open"><span>other</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/luvue/engineering/other/01-浏览器渲染原理与性能优化.html" class="sidebar-link">01-浏览器渲染原理与性能优化</a></li><li><a href="/luvue/engineering/other/02-lerna+yarn-workspace使用总结.html" class="active sidebar-link">02-lerna+yarn-workspace使用总结</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/luvue/engineering/other/02-lerna+yarn-workspace使用总结.html#模式对比" class="sidebar-link">模式对比</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/luvue/engineering/other/02-lerna+yarn-workspace使用总结.html#multirepo" class="sidebar-link">Multirepo</a></li><li class="sidebar-sub-header"><a href="/luvue/engineering/other/02-lerna+yarn-workspace使用总结.html#monorepo" class="sidebar-link">Monorepo</a></li><li class="sidebar-sub-header"><a href="/luvue/engineering/other/02-lerna+yarn-workspace使用总结.html#lerna-yarn-workspace-应用场景" class="sidebar-link">lerna + yarn workspace 应用场景</a></li></ul></li><li class="sidebar-sub-header"><a href="/luvue/engineering/other/02-lerna+yarn-workspace使用总结.html#lerna" class="sidebar-link">Lerna</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/luvue/engineering/other/02-lerna+yarn-workspace使用总结.html#lerna-管理模式" class="sidebar-link">Lerna 管理模式</a></li><li class="sidebar-sub-header"><a href="/luvue/engineering/other/02-lerna+yarn-workspace使用总结.html#lerna-入门指引" class="sidebar-link">Lerna 入门指引</a></li><li class="sidebar-sub-header"><a href="/luvue/engineering/other/02-lerna+yarn-workspace使用总结.html#lerna-管理命令" class="sidebar-link">Lerna 管理命令</a></li><li class="sidebar-sub-header"><a href="/luvue/engineering/other/02-lerna+yarn-workspace使用总结.html#lerna-配置文件" class="sidebar-link">Lerna 配置文件</a></li><li class="sidebar-sub-header"><a href="/luvue/engineering/other/02-lerna+yarn-workspace使用总结.html#lerna-应用-demo" class="sidebar-link">Lerna 应用 Demo</a></li><li class="sidebar-sub-header"><a href="/luvue/engineering/other/02-lerna+yarn-workspace使用总结.html#lerna-版本发布" class="sidebar-link">Lerna 版本发布</a></li><li class="sidebar-sub-header"><a href="/luvue/engineering/other/02-lerna+yarn-workspace使用总结.html#lerna-最佳实践" class="sidebar-link">Lerna 最佳实践</a></li><li class="sidebar-sub-header"><a href="/luvue/engineering/other/02-lerna+yarn-workspace使用总结.html#leran-注意事项" class="sidebar-link">Leran 注意事项</a></li></ul></li><li class="sidebar-sub-header"><a href="/luvue/engineering/other/02-lerna+yarn-workspace使用总结.html#yarn-workspace" class="sidebar-link">yarn workspace</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/luvue/engineering/other/02-lerna+yarn-workspace使用总结.html#yarn-workspace-管理工程" class="sidebar-link">yarn workspace 管理工程</a></li><li class="sidebar-sub-header"><a href="/luvue/engineering/other/02-lerna+yarn-workspace使用总结.html#yarn-workspace-管理命令" class="sidebar-link">yarn workspace 管理命令</a></li><li class="sidebar-sub-header"><a href="/luvue/engineering/other/02-lerna+yarn-workspace使用总结.html#yarn-workspace-入门实战" class="sidebar-link">yarn workspace 入门实战</a></li></ul></li></ul></li><li><a href="/luvue/engineering/other/03-pnpm+workspace+changesets构建monorepo工程.html" class="sidebar-link">03-pnpm+workspace+changesets构建monorepo工程</a></li><li><a href="/luvue/engineering/other/04-使用vue3+pnpm从0搭建monorepo项目.html" class="sidebar-link">04-使用vue3+pnpm从0搭建monorepo项目</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/luvue/engineering/rollup/" class="sidebar-heading clickable"><span>rollup</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/luvue/engineering/vue-cli/" class="sidebar-heading clickable"><span>vue-cli</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/luvue/engineering/webpack/" class="sidebar-heading clickable"><span>webpack</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/luvue/engineering/webpack2/" class="sidebar-heading clickable"><span>webpack2</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="lerna-yarn-workspace-使用总结"><a href="#lerna-yarn-workspace-使用总结" class="header-anchor">#</a> lerna + yarn workspace 使用总结</h1> <p></p><div class="table-of-contents"><ul><li><a href="#模式对比">模式对比</a><ul><li><a href="#multirepo">Multirepo</a></li><li><a href="#monorepo">Monorepo</a></li><li><a href="#lerna-yarn-workspace-应用场景">lerna + yarn workspace 应用场景</a></li></ul></li><li><a href="#lerna">Lerna</a><ul><li><a href="#lerna-管理模式">Lerna 管理模式</a></li><li><a href="#lerna-入门指引">Lerna 入门指引</a></li><li><a href="#lerna-管理命令">Lerna 管理命令</a></li><li><a href="#lerna-配置文件">Lerna 配置文件</a></li><li><a href="#lerna-应用-demo">Lerna 应用 Demo</a></li><li><a href="#lerna-版本发布">Lerna 版本发布</a></li><li><a href="#lerna-最佳实践">Lerna 最佳实践</a></li><li><a href="#leran-注意事项">Leran 注意事项</a></li></ul></li><li><a href="#yarn-workspace">yarn workspace</a><ul><li><a href="#yarn-workspace-管理工程">yarn workspace 管理工程</a></li><li><a href="#yarn-workspace-管理命令">yarn workspace 管理命令</a></li><li><a href="#yarn-workspace-入门实战">yarn workspace 入门实战</a></li></ul></li></ul></div><p></p> <p>lerna 管理方式属于 <code>Monorepo</code> 模式，这有别于传统的 <code>Multirepo</code> 单仓库应用模式，下面我们先来了解一下两者的区别。</p> <h2 id="模式对比"><a href="#模式对比" class="header-anchor">#</a> 模式对比</h2> <h3 id="multirepo"><a href="#multirepo" class="header-anchor">#</a> Multirepo</h3> <p>传统的项目开发模式，比如 create-react-app、vue-cli 等框架模板脚手架生成的项目。</p> <ul><li>优点：
<ol><li>各模块管理自由度高；</li> <li>各模块仓库体积一般不会太大；</li></ol></li> <li>缺点
<ol><li>仓库分散不好找，分支管理混乱；</li> <li>版本更新频繁，公共模块版本发生变化，需要对所有模块进行依赖更新；</li></ol></li></ul> <h3 id="monorepo"><a href="#monorepo" class="header-anchor">#</a> Monorepo</h3> <ul><li>优点：
<ol><li>统一的规范、构建工具；</li> <li>方便版本管理和依赖，模块之间的引用调试都变得非常方便；</li> <li>Multirepo 的缺点就是它的优点。</li></ol></li> <li>缺点：
<ol><li>随着应用扩展，仓库体积将变大。</li></ol></li></ul> <h3 id="lerna-yarn-workspace-应用场景"><a href="#lerna-yarn-workspace-应用场景" class="header-anchor">#</a> lerna + yarn workspace 应用场景</h3> <ol><li>作为业务组件库的工程环境搭建。
实现单个业务组件作为单独的 <code>npm</code> 包 进行管理和发布，无需将各个业务组件分开建立在多个 Git 仓库中，且它们的技术栈、构建工具、规范等都可以保持一致。</li> <li>作为日常业务项目工程管理。
比如有一个低代码业务需求，低代码核心工作区的交互都相同，不同的是业务场景（外层壳子和一些定制功能），低代码相关的模块都可以复用，我们只需在这个仓库内不断去扩展业务需求即可，达到核心代码的复用（当然，可能会想到将低代码核心作为线上包）。</li></ol> <h2 id="lerna"><a href="#lerna" class="header-anchor">#</a> Lerna</h2> <p>Lerna 是一个管理工具，用于管理包含多个软件包（package）的 JavaScript 项目，是 Babel 自己用来维护自己的 Monorepo 并开源出的一个项目。</p> <p>它可以：</p> <ul><li>统一的一套规范、构建标准；</li> <li>对相互耦合较大、相互独立的 JS/Git 库进行管理；</li> <li>统一的工作流和 Code Sharing（代码共享）。</li></ul> <p>下面我们从以下几个方面来熟悉 Lerna：</p> <ul><li>Lerna 管理模式；</li> <li>Lerna 入门指引；</li> <li>Lerna 管理命令；</li> <li>Lerna 配置文件；</li> <li>Lerna 应用 Demo；</li> <li>Lerna 版本发布；</li> <li>Lerna 最佳实践；</li> <li>Lerna 注意事项。</li></ul> <h3 id="lerna-管理模式"><a href="#lerna-管理模式" class="header-anchor">#</a> Lerna 管理模式</h3> <p>lerna 管理项目可以使用两种模式，默认固定模式，当使用 <code>lerna init -i</code> 命令初始化项目时，此时为独立模式。（模式是用来管理多个 package 发包时的方式）</p> <ol><li>固定模式：
在发包时会检测 packages 下涉及到变更的包，给这些变更的包使用同一版本，未发生变更的包不应用改版本，且不做发布升级；发布时可通过 lerna publish major（大） | minor（中） | patch （小）自定义版本。</li> <li>独立模式（常用的模式）：
允许每个包有自己独立的版本号，在 lerna publish 发布时，需要为每个改动的库指定版本号（逐个询问需要升级的版本号）。此模式，lerna.json - version 字段指定为 independent。</li></ol> <blockquote><p>如果 packages 下，其中一个包发生改动，另一个包依赖了这个包，即使它没有发生改动，也会被进行发布更新。</p></blockquote> <h3 id="lerna-入门指引"><a href="#lerna-入门指引" class="header-anchor">#</a> Lerna 入门指引</h3> <ol><li>全局安装 Lerna：<div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">npm</span> <span class="token function">install</span> --global lerna
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li>初始化 git 代码仓库：<div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">git</span> init lerna-repo <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> lerna-repo
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li>初始化 Lerna：<div class="language-sh line-numbers-mode"><pre class="language-sh"><code>lerna init
// lerna info Creating package.json
// lerna info Creating lerna.json
// lerna info Creating packages directory
// lerna success Initialized Lerna files
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li>此时得到了这样一个仓库目录结构：<div class="language-sh line-numbers-mode"><pre class="language-sh"><code>lerna-repo/
    packages/
    package.json
    lerna.json
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div>其中 <code>packages</code> 中保存着每个独立的包模块。</li> <li>安装 lerna 到仓库 node_modules 中：<div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">npm</span> <span class="token function">install</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ol> <p>至此，我们就完成了一个 Lerna 工程的初始化工作，下面我们掌握一些操作命令来管理 Lerna。</p> <h3 id="lerna-管理命令"><a href="#lerna-管理命令" class="header-anchor">#</a> Lerna 管理命令</h3> <ol><li><p><code>lerna init</code>
将一个仓库初始化为 lerna 仓库（默认固定模式）。支持参数：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>--independent/-i – 使用独立的版本控制模式
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>lerna create 「package」</code>
创建一个 package 到项目工程的 packages 下。</p></li> <li><p><code>lerna add 「module」</code></p> <ul><li>为每个 package 都安装指定依赖：<div class="language-sh line-numbers-mode"><pre class="language-sh"><code>lerna <span class="token function">add</span> react
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li>为指定的 package 安装特定依赖：<div class="language-sh line-numbers-mode"><pre class="language-sh"><code>lerna <span class="token function">add</span> react-dom packages/package1
// or
lerna <span class="token function">add</span> react-dom --scope<span class="token operator">=</span>package1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li>添加依赖到根目录 node_modules 中：<div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">npm</span> <span class="token function">install</span> typescript -D
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li>package 之间的相互依赖（会在 package/package.json 下添加该依赖）：<div class="language-sh line-numbers-mode"><pre class="language-sh"><code>lerna <span class="token function">add</span> package2 --scope package1
// or
lerna <span class="token function">add</span> package2 packages/package1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ul></li> <li><p><code>lerna publish</code>
用于 npm 包版本发布，具体细节可看下文 「Lerna 版本发布」。</p></li> <li><p><code>lerna bootstrap</code>
用于将 packages 链接在一起(前提是相互依赖的库)，并安装 package 下的依赖到 package/node_modules。</p> <blockquote><p>注意，它不会安装根目录 package.json 的依赖，如果需要安装根目录依赖，请使用 npm install。</p></blockquote> <p>参数：<code>--hoist</code>：依赖提升，把每个 package 下的依赖包都 <code>提升</code> 到工程根目录（删除包下的 node_modules，将依赖安装在根目录，但依赖注册不会在 package/package.json 内删除，也不会在 root/package.json 内添加此依赖）</p></li> <li><p><code>lerna clean</code>
删除各个包下的 node_modules（不会删除根目录 node_modules）。</p></li> <li><p>lerna ls
列出当前 Lerna 仓库中的所有公共软件包（public packages）。</p></li> <li><p><code>lerna run 「script」</code></p> <ul><li>运行每个包下面的 script（如果某个包没有此 script，将会报错）<div class="language-sh line-numbers-mode"><pre class="language-sh"><code>lerna run <span class="token builtin class-name">test</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li>运行某个包下面的 script<div class="language-sh line-numbers-mode"><pre class="language-sh"><code>lerna run <span class="token builtin class-name">test</span> --scope package1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul></li> <li><p><code>lerna exec 「shell」</code>
允许去执行 shell 脚本</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>lerna <span class="token builtin class-name">exec</span> webpack
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>lerna changed</code>
检查自上次发布以来哪些软件包被修改过。</p></li> <li><p><code>lerna link</code>
链接互相引用的库，当 pakcage/package.json 内明确了 packages 下的包时，才会将相关包链接到 package/node_modules 中。</p></li> <li><p><code>lerna info</code>
查看 lerna 及运行环境的信息。</p></li></ol> <h3 id="lerna-配置文件"><a href="#lerna-配置文件" class="header-anchor">#</a> Lerna 配置文件</h3> <p>在 lerna.json 配置文件内可以指定工作模式、packages 的位置以及一些命令的默认参数定义，如下示例：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;npmClient&quot;</span><span class="token operator">:</span> <span class="token string">&quot;yarn&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;useWorkspaces&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">&quot;packages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;packages/*&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;command&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;bootstrap&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;npmClientArgs&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;--no-package-lock&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;publish&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;npmClient&quot;</span><span class="token operator">:</span> <span class="token string">&quot;npm&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;ignoreChanges&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;**/*.md&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;**/test/**&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chore(release): publish&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;registry&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://registry.npmjs.org&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;conventionalCommits&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><ul><li><code>version</code>: 当前仓库的版本，Independent mode 请设置为 independent；</li> <li><code>packages</code>: 指定包所在的目录，支持指定多个目录；</li> <li><code>npmClient</code>: 允许指定命令使用的 client， 默认是 npm， 可以设置成 yarn；</li> <li><code>useWorkspaces</code>: 使用 yarn workspaces 管理 Monorepo；</li> <li><code>command.bootstrap.npmClientArgs</code>: 指定默认传给 lerna bootstrap 命令的参数；</li> <li><code>command.publish.ignoreChanges</code>: 指定那些目录或者文件的变更不用触发 package 版本的变更；</li> <li><code>command.publish.message</code>: 执行发布版本更新时的生成的 commit message；</li> <li><code>command.publish.registry</code>: 指定发布到的 registry url，比如可以发布到指定私服，默认是 npmjs.org；</li> <li><code>command.publish.conventionalCommits</code>: lerna version 将生成 CHANGELOG.md files（如果设置了这个，lerna 管理模式将直接使用固定模式，version = independent 的配置将失效）。</li></ul> <h3 id="lerna-应用-demo"><a href="#lerna-应用-demo" class="header-anchor">#</a> Lerna 应用 Demo</h3> <p>有了上面的基础使用的了解，下面我们通过一个简单 Demo 熟悉一下 Lerna 管理 Packages 的流程方式。</p> <ol><li><p>创建 Lerna 工程：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">git</span> init lerna-demo <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> lerna-demo <span class="token operator">&amp;&amp;</span> lerna init
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>创建两个 package：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>lerna create lerna-module1
lerna create lerna-module2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>在 package 中维护几行测试代码：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// lerna-module1/lib/lerna-module1.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> lernaModule1<span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">lernaModule1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'lerna-module1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// lerna-module2/lib/lerna-module2.js</span>
<span class="token keyword">const</span> lernaModule1 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'lerna-module1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> lernaModule2<span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">lernaModule2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'lerna-module2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">lernaModule1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">lernaModule2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></li> <li><p>在 lerna-module2 下添加一个执行脚本：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// lerna-module2/package.json</span>
<span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token string-property property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node ./lib/lerna-module2.js&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>运行脚本：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>lerna run <span class="token builtin class-name">test</span> --scope lerna-module2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>此时会看到终端报错信息：</p> <blockquote><p>Error: Cannot find module 'lerna-module1'</p></blockquote></li> <li><p>手动建立 package 之间的关联：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>lerna <span class="token function">add</span> lerna-module1 --scope lerna-module2
<span class="token comment"># lerna info Adding lerna-module1 in 1 package</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p>此时可以在 lerna-module2 目录下看到生成了 node_modules 文件夹，并且在里面放置了和 lerna-module1 一模一样的包（软链接）。</p></blockquote></li> <li><p>再来执行一次命令：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>lerna run <span class="token builtin class-name">test</span> --scope lerna-module2
终端输出：
lerna-module1
lerna-module2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li></ol> <h3 id="lerna-版本发布"><a href="#lerna-版本发布" class="header-anchor">#</a> Lerna 版本发布</h3> <p>packages 下的包版本发布需要使用 <code>lerna publish</code>，这个命令组合了这两个命令：<code>lerna version</code> 和 <code>npm publish</code>。<br>
其中 lerna version 针对 Lerna 的管理模式（固定模式和独立模式），在表现上有所不同。<br>
但主要工作还是在进行 <code>npm publish</code> 之前，去管理哪些包要进行发布，以及发布过程中生成的 Git commit、Git tag 的提交。</p> <ol><li>固定模式下的 lerna version：
<ul><li>找出从上一个版本发布以来有过<code>变更的 package</code>；</li> <li>根据当前 lerna.json 中的版本<code>生成新的版本号</code>；</li> <li>更新涉及到变更 package 下的 package.json 版本号；</li> <li>更新 lerna.json 文件中的版本号；</li> <li>将 <code>version</code> 更新、生成的 <code>CHANGELOG.md</code> 文件带来的变动提交为一次 commit；</li> <li>基于这次 commit 为所有涉及到更新的 package 打上各自的 tag；</li> <li>推送 commit 和 tags 到远程仓库。</li></ul></li> <li>独立模式下的 lerna version：
<ul><li>找出从上一个版本发布以来有过变更的 package；</li> <li>提示开发者为需要更新的 package 选择（一组 Version Select）要发布的版本号；</li> <li>更新到 package 下的 package.json version 版本号；</li> <li>如果 packages 下其他包有依赖这个包，那么其他包的 package.json 此包版本也会更新；</li> <li>将 version 更新、生成的 CHANGELOG.md 文件带来的变动提交为一次 commit；</li> <li>基于这次 commit 为所有涉及到更新的 package 打上各自的 tag；</li> <li>推送 commit 和 tags 到远程仓库。</li></ul></li></ol> <p>这里需要注意一下 lerna 查找包变更的逻辑：</p> <div class="custom-block tip"><p class="custom-block-title">lerna 查找包变更的逻辑</p> <p>在当前分支，找到最近一次 tag，将当前 commit 和 tag 进行比较，看哪些 package 下的文件发生了变更。</p></div> <p>命令使用如下：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>lerna publish
lerna publish semver
<span class="token comment"># semver bump [major | minor | patch | premajor | preminor | prepatch | prerelease]</span>
lerna publish from <span class="token function">git</span>
lerna publish from-package
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>初次使用发布时可能会遇到以下一些问题和注意事项：</p> <ol><li>避免开发者自己去打 tag。
lerna 发布时会自动生成 tag，并且查找更新是基于 tag 来识别的，避免开发者手动打上 tag 后，影响 lerna 查找变更，可能会造成一些变更包没有按照预期发布。</li> <li>避免多条分支同时进行。
在多条分支同时进行时，可能会生成相同的版本号，从而发生版本冲突。解决办法：分支开发者之前应提前约定好版本。</li> <li>lerna publish 中途发布失败，如何进行重发布。
有时候发布可能会失败（比如 npm 没有登录、没有使用 npmjs 镜像源），再次运行 lerna publish 时，因为 tag 已经打上了，无法再查找到更新，进行包的发布。<br>
可以采用下面两种发布方式：
<ul><li>运行 <code>lerna publish from-git</code>。会将当前标签中涉及的 NPM 包再发布一次。（不会再更新 package.json，只是执行 npm publish）；</li> <li>运行 <code>lerna publish from-package</code>。会将当前所有本地包中的 package.json 和远端 npm 比对，如果 npm 上不存在此包的最新版本，都执行一次 npm publish。</li></ul></li></ol> <h3 id="lerna-最佳实践"><a href="#lerna-最佳实践" class="header-anchor">#</a> Lerna 最佳实践</h3> <p>目前业界使用最多的方案是：<code>lerna + yarm workspace</code> 结合的 <code>Monorepo</code> 方案，两者工作职责划分不同：</p> <ul><li><code>yarn</code> 处理依赖安装工作（只想做好包管理工具）；</li> <li><code>lerna</code> 处理发布流程。</li></ul> <h3 id="leran-注意事项"><a href="#leran-注意事项" class="header-anchor">#</a> Leran 注意事项</h3> <ol><li><p>发布前，提交工作区的变更。
在发布前，需要提交工作区的文件变更，否则终端会收到下面报错信息：</p> <blockquote><p>lerna ERR! EUNCOMMIT Working tree has uncommitted changes, please commit or remove the following changes before continuing:</p></blockquote></li> <li><p>发布前，需使用 npmjs.org 镜像。
在发布前，如果 npm 设置的镜像源为淘宝镜像，需要切换回 npm 镜像：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">npm</span> config get registry
<span class="token function">npm</span> config <span class="token builtin class-name">set</span> registry https://registry.npmjs.org
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>如果要发布一个 Scope 包：
Scope 是指具有“组织”的包，比如 Babel 的相关包都是这一格式：@babel/xxx，在发布一个具有 Scope 包时，需要确保 Organization（组织）已在 npm 上创建，私有包需要收费，公共包则为免费。<br>
在发布 Scope package 时，需要在 package.json 声明 access publish：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;@feu/tools&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;publishConfig&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;access&quot;</span><span class="token operator">:</span> <span class="token string">&quot;publish&quot;</span> <span class="token comment">// 如果该模块需要发布，对于 scope 模块，需要设置为 publish</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p>发布意外中断，进行重发布：
如果发布因为某些原因中断了，未发布成功，再次执行发布，会得到如下提示：</p> <blockquote><p>lerna success No changed packages to publish</p></blockquote> <p>但由于包并未成功发布到 npmjs 上，这时可以执行以下命令进行重发布：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>lerna publish from-git
<span class="token comment"># or</span>
lerna publish from-package
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>independent 模式并未生效：
在 lerna.json 下指定了 version 为 independent，但是发布时却还是固定模式的流程，原因可能是 lerna.json 内配置了 <code>conventionalCommits</code>：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;command&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;publish&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;conventionalCommits&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>可以将其配置移除得到解决。</p></li> <li><p>固定模式如何自己指定版本：
当我们执行 lerna publish 时，lerna 会<code>自定分配一个版本</code>提供我们使用；但这个版本可能不是我们期望发布的版本；如何自己控制发布的版本呢，在发布时我们可以传递配置：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>lerna publish major（大） <span class="token operator">|</span> minor（中） <span class="token operator">|</span> patch （小）
lerna publish patch <span class="token comment"># 发布小版本</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ol> <h2 id="yarn-workspace"><a href="#yarn-workspace" class="header-anchor">#</a> yarn workspace</h2> <p>对于 <code>Monorepo</code> 的工程，使用最多的方式是 <code>lerna</code> 结合 <code>yarn workspace</code> 一起使用。<br>
因为 <code>yarn</code> 在依赖管理上做的非常不错，适合我们业务场景的依赖模块管理。<br>
而 package 的发布工作依旧交由 <code>lerna publish</code> 来运转。</p> <p>下面我们从以下几个方面来熟悉 yarn workspace：</p> <ul><li>yarn workspace 管理工程；</li> <li>yarn workspace 管理命令；</li> <li>yarn workspace 入门实战。</li></ul> <h3 id="yarn-workspace-管理工程"><a href="#yarn-workspace-管理工程" class="header-anchor">#</a> yarn workspace 管理工程</h3> <p>初始化工程的步骤和上面 <code>lerna</code> 的方式一样，与 lerna 不同的是，需要做以下配置：</p> <ol><li>在 lerna.json 中声明使用 <code>yarn workspace</code> 进行依赖管理：<div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  ...
  <span class="token property">&quot;npmClient&quot;</span><span class="token operator">:</span> <span class="token string">&quot;yarn&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;useWorkspaces&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li>在 <code>root/package.json</code> 下必需包含 <code>workspaces</code> 数组，与 <code>lerna.json</code> 下的 <code>packages</code> 保持一致：<div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token string-property property">&quot;private&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 工作空间不需要发布</span>
  <span class="token operator">...</span>
  <span class="token string-property property">&quot;workspaces&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;packages/*&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li></ol> <h3 id="yarn-workspace-管理命令"><a href="#yarn-workspace-管理命令" class="header-anchor">#</a> yarn workspace 管理命令</h3> <p>yarn 管理命令大致分为两类（容易混淆，这里先提及一下）：</p> <ul><li>处理工程下指定的包模块时使用：<code>yarn workspace</code>；</li> <li>处理工程根目录全局或所有包模块时使用：<code>yarn workspaces</code>。</li></ul> <ol><li><p><code>yarn install</code>
代替 <code>npm install + lerna bootstrap</code> 安装工程依赖。</p> <p>它与 lerna bootstarp 不同的是：</p> <ul><li><code>yarn install</code> 会将 <code>package</code> 下的依赖<code>统一安装到根目录之下</code>。这有利于提升依赖的安装效率和不同 package 间的版本复用（有些包是需要私有依赖的，而私有依赖会被多个包安装多次，而提升依赖可以解决这一问题）。</li> <li>yarn install 会自动帮助解决安装（包括根目录下的安装）和 packages link 问题。</li></ul></li> <li><p><code>yarn add 「module」</code></p> <ul><li>为每个 package 都安装指定依赖：<div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">yarn</span> workspaces <span class="token function">add</span> react
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li>为指定的 package 安装特定依赖：<div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">yarn</span> workspace package1 <span class="token function">add</span> react react-dom --save
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>注意，package1 一定是 packages/package1/package.json name 字段，有时候 package 的目录名和 name 字段不一致，要以 name 为准。</p></blockquote></li> <li>添加依赖到根目录 node_modules 中：<div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token builtin class-name">cd</span> 根目录
<span class="token function">yarn</span> <span class="token function">add</span> @babel/core -D -W （-W 表示将依赖添加到 workspaces 根目录）
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li>package 之间的相互依赖（会在 package/package.json 下添加该依赖）：<div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">yarn</span> workspace package1 <span class="token function">add</span> package2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>注意，当 package2 没有发布在 npmjs 上时，此时会报错：package2 not found；解决办法：显示指定 package2 的版本： yarn workspace package1 add package2@^1.0.0</p></blockquote></li> <li>在工程根目录下引入 packages/package 包：<div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">yarn</span> <span class="token function">add</span> package@^1.0.0 -W
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul></li> <li><p><code>yarn remove「module」</code>
和上面 yarn add 命令格式相同，只需将 add 替换为 remove 即可。</p></li> <li><p><code>yarn run 「script」</code></p> <ul><li>运行工程根目录下 script：<div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">yarn</span> <span class="token builtin class-name">test</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li>运行指定包模块下的 script：<div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">yarn</span> workspace package1 run <span class="token builtin class-name">test</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>值得注意的是，命令虽然是在根目录下执行，但在执行文件中拿到的 <code>process.cwd()</code> 是 <code>package</code> 下的执行文件所在路径</p></blockquote></li> <li>运行所有 package 下的 script 命令：<div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">yarn</span> workspaces run <span class="token builtin class-name">test</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>注意，如果某个 package 下没有对应 script，将会终止命令，并报错。若 package 不具备 script，可以定义一个占位 script，类似如下：</p></blockquote> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;lint&quot;</span><span class="token operator">:</span> <span class="token string">&quot;echo lint successful.&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ul></li> <li><p><code>yarn workspaces info</code>
查看 workspace 依赖树信息。</p></li></ol> <h3 id="yarn-workspace-入门实战"><a href="#yarn-workspace-入门实战" class="header-anchor">#</a> yarn workspace 入门实战</h3> <ol><li><p>新建 yarn workspace 工程：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">git</span> init yarn-demo <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> yarn-demo <span class="token operator">&amp;&amp;</span> <span class="token function">yarn</span> init -y <span class="token operator">&amp;&amp;</span> <span class="token function">yarn</span> <span class="token function">add</span> lerna -D <span class="token operator">&amp;&amp;</span> lerna init
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>配置 lerna.json 改用 yarn workspaces：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token comment">// lerna.json</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;npmClient&quot;</span><span class="token operator">:</span> <span class="token string">&quot;yarn&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;useWorkspaces&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">&quot;packages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;packages/*&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;independent&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>根目录 package.json 必须包含一个 workspaces 数组:</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;private&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 工作空间不需要发布</span>
  <span class="token property">&quot;workspaces&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;packages/*&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  ...
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>新建两个 package：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token builtin class-name">cd</span> packages <span class="token operator">&amp;&amp;</span> <span class="token function">mkdir</span> yarn-module1 <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> yarn-module1 <span class="token operator">&amp;&amp;</span> <span class="token function">yarn</span> init -y
<span class="token builtin class-name">cd</span> packages <span class="token operator">&amp;&amp;</span> <span class="token function">mkdir</span> yarn-module2 <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> yarn-module2 <span class="token operator">&amp;&amp;</span> <span class="token function">yarn</span> init -y
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>添加几行测试代码：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// yarn-module1/index.js</span>
<span class="token keyword">function</span> <span class="token function">yarnModule1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'yarn-module1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> yarnModule1<span class="token punctuation">;</span>

<span class="token comment">// yarn-module2/index.js</span>
<span class="token keyword">const</span> yarnModule1 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'yarn-module1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">yarnModule2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'yarn-module2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">yarnModule1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">yarnModule2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> yarnModule2<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div></li> <li><p>为 yarn-module2 添加个 script：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token comment">// yarn-module2/package.json</span>
<span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node index.js&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>回到根目录执行 script：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">yarn</span> workspace yarn-module2 run <span class="token builtin class-name">test</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>不出意外，会得到如下错误：</p> <blockquote><p>Error: Cannot find module 'yarn-module1'</p></blockquote></li> <li><p>建立 package 之间的关系：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">yarn</span> <span class="token function">install</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>可以看到，根目录下的 node_modules 中已经存在了 yarn-module1 和 yarn-module2 这两个包，与 lerna 的区别在于没有在各自的 package 下创建 node_modules，而是统一链接到根目录。<br>
但，<code>yarn-module2</code> 中依赖的 <code>yarn-module1</code>，应该将其添加到 package.json 中，最好的方式是采用</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">yarn</span> workspace yarn-module2 <span class="token function">add</span> yarn-module1@^1.0.0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>再来一次 script：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">yarn</span> workspace yarn-module2 run <span class="token builtin class-name">test</span>

输出：
yarn-module1
yarn-module2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/luvue/engineering/other/01-浏览器渲染原理与性能优化.html" class="prev">01-浏览器渲染原理与性能优化</a></span> <span class="next"><a href="/luvue/engineering/other/03-pnpm+workspace+changesets构建monorepo工程.html">03-pnpm+workspace+changesets构建monorepo工程</a>
      →
    </span></p></div> </main> <span data-v-2ae0ee72></span></div><div class="global-ui"></div></div>
    <script src="/luvue/assets/js/app.24d3cb9c.js" defer></script><script src="/luvue/assets/js/2.7e9a2be9.js" defer></script><script src="/luvue/assets/js/3.92ecc592.js" defer></script><script src="/luvue/assets/js/56.a651fa0f.js" defer></script>
  </body>
</html>
