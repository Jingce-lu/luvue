<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>源码相关 | Ailjc notes</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel=" " href=" ">
    <meta name="description" content=" ">
    
    <link rel="preload" href="/assets/css/0.styles.e687256a.css" as="style"><link rel="preload" href="/assets/js/app.5453d833.js" as="script"><link rel="preload" href="/assets/js/2.edd550b3.js" as="script"><link rel="preload" href="/assets/js/3.29a3f40f.js" as="script"><link rel="preload" href="/assets/js/203.b19a9896.js" as="script"><link rel="prefetch" href="/assets/js/10.45961e4a.js"><link rel="prefetch" href="/assets/js/100.cdaae3a3.js"><link rel="prefetch" href="/assets/js/101.be077908.js"><link rel="prefetch" href="/assets/js/102.857f579a.js"><link rel="prefetch" href="/assets/js/103.ac7164da.js"><link rel="prefetch" href="/assets/js/104.35dd95b3.js"><link rel="prefetch" href="/assets/js/105.4c866dbb.js"><link rel="prefetch" href="/assets/js/106.d60f7eee.js"><link rel="prefetch" href="/assets/js/107.53d8436c.js"><link rel="prefetch" href="/assets/js/108.4f94dc95.js"><link rel="prefetch" href="/assets/js/109.d6585cd4.js"><link rel="prefetch" href="/assets/js/11.20012366.js"><link rel="prefetch" href="/assets/js/110.27af1683.js"><link rel="prefetch" href="/assets/js/111.dde43606.js"><link rel="prefetch" href="/assets/js/112.ccb20cb6.js"><link rel="prefetch" href="/assets/js/113.23a9833e.js"><link rel="prefetch" href="/assets/js/114.42c6a414.js"><link rel="prefetch" href="/assets/js/115.58d08b40.js"><link rel="prefetch" href="/assets/js/116.31367804.js"><link rel="prefetch" href="/assets/js/117.d530886d.js"><link rel="prefetch" href="/assets/js/118.d03fd7ca.js"><link rel="prefetch" href="/assets/js/119.b4ba1fec.js"><link rel="prefetch" href="/assets/js/12.3ec53ea8.js"><link rel="prefetch" href="/assets/js/120.f7cdcf33.js"><link rel="prefetch" href="/assets/js/121.9edf8d61.js"><link rel="prefetch" href="/assets/js/122.516425b2.js"><link rel="prefetch" href="/assets/js/123.85ada9d3.js"><link rel="prefetch" href="/assets/js/124.55de3407.js"><link rel="prefetch" href="/assets/js/125.75a8f93d.js"><link rel="prefetch" href="/assets/js/126.485292bb.js"><link rel="prefetch" href="/assets/js/127.274beb15.js"><link rel="prefetch" href="/assets/js/128.5234acb9.js"><link rel="prefetch" href="/assets/js/129.c7f7fd63.js"><link rel="prefetch" href="/assets/js/13.4d1c9585.js"><link rel="prefetch" href="/assets/js/130.1b47d904.js"><link rel="prefetch" href="/assets/js/131.0b06ac47.js"><link rel="prefetch" href="/assets/js/132.54414c2d.js"><link rel="prefetch" href="/assets/js/133.fc024453.js"><link rel="prefetch" href="/assets/js/134.1ebf2f7b.js"><link rel="prefetch" href="/assets/js/135.58071e80.js"><link rel="prefetch" href="/assets/js/136.8d718f9a.js"><link rel="prefetch" href="/assets/js/137.dc3f0b8c.js"><link rel="prefetch" href="/assets/js/138.aaa35cdb.js"><link rel="prefetch" href="/assets/js/139.c01e7a66.js"><link rel="prefetch" href="/assets/js/14.4368d31f.js"><link rel="prefetch" href="/assets/js/140.8c150c50.js"><link rel="prefetch" href="/assets/js/141.4220b633.js"><link rel="prefetch" href="/assets/js/142.4f344477.js"><link rel="prefetch" href="/assets/js/143.077c9793.js"><link rel="prefetch" href="/assets/js/144.c3461c40.js"><link rel="prefetch" href="/assets/js/145.c262dd72.js"><link rel="prefetch" href="/assets/js/146.c1bf6fef.js"><link rel="prefetch" href="/assets/js/147.49e20552.js"><link rel="prefetch" href="/assets/js/148.b0b94a1e.js"><link rel="prefetch" href="/assets/js/149.bdd5c660.js"><link rel="prefetch" href="/assets/js/15.7341232d.js"><link rel="prefetch" href="/assets/js/150.d37a2c1b.js"><link rel="prefetch" href="/assets/js/151.ea38a2e0.js"><link rel="prefetch" href="/assets/js/152.34b60e21.js"><link rel="prefetch" href="/assets/js/153.926d1496.js"><link rel="prefetch" href="/assets/js/154.5d7f764e.js"><link rel="prefetch" href="/assets/js/155.4f05ce74.js"><link rel="prefetch" href="/assets/js/156.c251b8f8.js"><link rel="prefetch" href="/assets/js/157.659c36e1.js"><link rel="prefetch" href="/assets/js/158.86b91fed.js"><link rel="prefetch" href="/assets/js/159.eeb62dbe.js"><link rel="prefetch" href="/assets/js/16.7dcffae2.js"><link rel="prefetch" href="/assets/js/160.26c7c228.js"><link rel="prefetch" href="/assets/js/161.83318b26.js"><link rel="prefetch" href="/assets/js/162.9811dde2.js"><link rel="prefetch" href="/assets/js/163.a00c0ecd.js"><link rel="prefetch" href="/assets/js/164.78675901.js"><link rel="prefetch" href="/assets/js/165.57c726cd.js"><link rel="prefetch" href="/assets/js/166.fc622104.js"><link rel="prefetch" href="/assets/js/167.eb02cd78.js"><link rel="prefetch" href="/assets/js/168.d80ace33.js"><link rel="prefetch" href="/assets/js/169.a2fe4ebc.js"><link rel="prefetch" href="/assets/js/17.d9200946.js"><link rel="prefetch" href="/assets/js/170.3334fe5b.js"><link rel="prefetch" href="/assets/js/171.644da1a1.js"><link rel="prefetch" href="/assets/js/172.66d4dad3.js"><link rel="prefetch" href="/assets/js/173.9b8f529e.js"><link rel="prefetch" href="/assets/js/174.c6821d3b.js"><link rel="prefetch" href="/assets/js/175.edcfc12d.js"><link rel="prefetch" href="/assets/js/176.54e8b4fc.js"><link rel="prefetch" href="/assets/js/177.888c1b03.js"><link rel="prefetch" href="/assets/js/178.2cc4a4f3.js"><link rel="prefetch" href="/assets/js/179.b8871aad.js"><link rel="prefetch" href="/assets/js/18.970d299c.js"><link rel="prefetch" href="/assets/js/180.dde37e1f.js"><link rel="prefetch" href="/assets/js/181.cadd9de0.js"><link rel="prefetch" href="/assets/js/182.26a780ff.js"><link rel="prefetch" href="/assets/js/183.c7633618.js"><link rel="prefetch" href="/assets/js/184.48d143e7.js"><link rel="prefetch" href="/assets/js/185.9bb54fb4.js"><link rel="prefetch" href="/assets/js/186.d8a8c5c6.js"><link rel="prefetch" href="/assets/js/187.366057c7.js"><link rel="prefetch" href="/assets/js/188.3119d73d.js"><link rel="prefetch" href="/assets/js/189.2597ec07.js"><link rel="prefetch" href="/assets/js/19.5b4f364a.js"><link rel="prefetch" href="/assets/js/190.d7856a04.js"><link rel="prefetch" href="/assets/js/191.e362659c.js"><link rel="prefetch" href="/assets/js/192.da1ed7b2.js"><link rel="prefetch" href="/assets/js/193.9b055401.js"><link rel="prefetch" href="/assets/js/194.b848666d.js"><link rel="prefetch" href="/assets/js/195.14b35ef5.js"><link rel="prefetch" href="/assets/js/196.db0788b7.js"><link rel="prefetch" href="/assets/js/197.c46efad6.js"><link rel="prefetch" href="/assets/js/198.6d2f0ca5.js"><link rel="prefetch" href="/assets/js/199.8281f9ba.js"><link rel="prefetch" href="/assets/js/20.04f94469.js"><link rel="prefetch" href="/assets/js/200.fac0cd43.js"><link rel="prefetch" href="/assets/js/201.ef78b025.js"><link rel="prefetch" href="/assets/js/202.70e4aec8.js"><link rel="prefetch" href="/assets/js/204.8621217d.js"><link rel="prefetch" href="/assets/js/205.75e6ce9f.js"><link rel="prefetch" href="/assets/js/206.fa0ea666.js"><link rel="prefetch" href="/assets/js/207.987a2c6c.js"><link rel="prefetch" href="/assets/js/208.a931f476.js"><link rel="prefetch" href="/assets/js/209.42f88558.js"><link rel="prefetch" href="/assets/js/21.4720e285.js"><link rel="prefetch" href="/assets/js/210.d3bfc368.js"><link rel="prefetch" href="/assets/js/211.01ea8708.js"><link rel="prefetch" href="/assets/js/212.dad5480f.js"><link rel="prefetch" href="/assets/js/213.06e75ae6.js"><link rel="prefetch" href="/assets/js/214.fe68d4c4.js"><link rel="prefetch" href="/assets/js/215.8dc1971f.js"><link rel="prefetch" href="/assets/js/216.eafecd5c.js"><link rel="prefetch" href="/assets/js/217.b74649d4.js"><link rel="prefetch" href="/assets/js/218.b8b7e762.js"><link rel="prefetch" href="/assets/js/219.40a2710d.js"><link rel="prefetch" href="/assets/js/22.a241c1de.js"><link rel="prefetch" href="/assets/js/220.cfbfa1cb.js"><link rel="prefetch" href="/assets/js/221.00213fcb.js"><link rel="prefetch" href="/assets/js/222.13b83182.js"><link rel="prefetch" href="/assets/js/223.1b88ec39.js"><link rel="prefetch" href="/assets/js/224.55e77afc.js"><link rel="prefetch" href="/assets/js/225.7a25aa80.js"><link rel="prefetch" href="/assets/js/226.f9c707c4.js"><link rel="prefetch" href="/assets/js/227.4ae88c67.js"><link rel="prefetch" href="/assets/js/228.2ca0a572.js"><link rel="prefetch" href="/assets/js/229.60c711b7.js"><link rel="prefetch" href="/assets/js/23.64b72b4e.js"><link rel="prefetch" href="/assets/js/230.cb03a065.js"><link rel="prefetch" href="/assets/js/231.8e43f45f.js"><link rel="prefetch" href="/assets/js/232.ea8bbde3.js"><link rel="prefetch" href="/assets/js/233.ac9af77c.js"><link rel="prefetch" href="/assets/js/234.ca2fc3f2.js"><link rel="prefetch" href="/assets/js/235.067bd5e8.js"><link rel="prefetch" href="/assets/js/236.3ad62ad0.js"><link rel="prefetch" href="/assets/js/237.cde00877.js"><link rel="prefetch" href="/assets/js/238.94eb3bd8.js"><link rel="prefetch" href="/assets/js/239.e70409b8.js"><link rel="prefetch" href="/assets/js/24.fef8c701.js"><link rel="prefetch" href="/assets/js/240.4241957b.js"><link rel="prefetch" href="/assets/js/241.c4ee5c82.js"><link rel="prefetch" href="/assets/js/25.409f40e0.js"><link rel="prefetch" href="/assets/js/26.f8b1ce9a.js"><link rel="prefetch" href="/assets/js/27.e82818fd.js"><link rel="prefetch" href="/assets/js/28.0bfb495f.js"><link rel="prefetch" href="/assets/js/29.4dbc1612.js"><link rel="prefetch" href="/assets/js/30.a959330e.js"><link rel="prefetch" href="/assets/js/31.100a41c6.js"><link rel="prefetch" href="/assets/js/32.79a3fc64.js"><link rel="prefetch" href="/assets/js/33.9d0f512a.js"><link rel="prefetch" href="/assets/js/34.c5c6c391.js"><link rel="prefetch" href="/assets/js/35.9ce2b7e0.js"><link rel="prefetch" href="/assets/js/36.fc80d89f.js"><link rel="prefetch" href="/assets/js/37.f09c0eb8.js"><link rel="prefetch" href="/assets/js/38.88b87058.js"><link rel="prefetch" href="/assets/js/39.23c596b8.js"><link rel="prefetch" href="/assets/js/4.5618a167.js"><link rel="prefetch" href="/assets/js/40.9afc4743.js"><link rel="prefetch" href="/assets/js/41.bad3ed94.js"><link rel="prefetch" href="/assets/js/42.0dec5451.js"><link rel="prefetch" href="/assets/js/43.aa9d0e21.js"><link rel="prefetch" href="/assets/js/44.221c217c.js"><link rel="prefetch" href="/assets/js/45.f0ba095d.js"><link rel="prefetch" href="/assets/js/46.d7bc08b5.js"><link rel="prefetch" href="/assets/js/47.fe5d4edf.js"><link rel="prefetch" href="/assets/js/48.0b4112ed.js"><link rel="prefetch" href="/assets/js/49.541d70b1.js"><link rel="prefetch" href="/assets/js/5.81cd1113.js"><link rel="prefetch" href="/assets/js/50.9338fa61.js"><link rel="prefetch" href="/assets/js/51.049b084e.js"><link rel="prefetch" href="/assets/js/52.05ae34dd.js"><link rel="prefetch" href="/assets/js/53.ae6a8566.js"><link rel="prefetch" href="/assets/js/54.dcdb9d9c.js"><link rel="prefetch" href="/assets/js/55.5c2e24e0.js"><link rel="prefetch" href="/assets/js/56.402eb13f.js"><link rel="prefetch" href="/assets/js/57.8fd6561f.js"><link rel="prefetch" href="/assets/js/58.c8f9291d.js"><link rel="prefetch" href="/assets/js/59.ff4a0fed.js"><link rel="prefetch" href="/assets/js/6.9a05f5dc.js"><link rel="prefetch" href="/assets/js/60.ef8ddbbc.js"><link rel="prefetch" href="/assets/js/61.ac9780cf.js"><link rel="prefetch" href="/assets/js/62.7eb6cd66.js"><link rel="prefetch" href="/assets/js/63.f6184b0a.js"><link rel="prefetch" href="/assets/js/64.f2df73ae.js"><link rel="prefetch" href="/assets/js/65.823ff3fe.js"><link rel="prefetch" href="/assets/js/66.068fa56b.js"><link rel="prefetch" href="/assets/js/67.a58f447e.js"><link rel="prefetch" href="/assets/js/68.ad0d4475.js"><link rel="prefetch" href="/assets/js/69.4b75ac3d.js"><link rel="prefetch" href="/assets/js/7.bf06d7b4.js"><link rel="prefetch" href="/assets/js/70.44da9c56.js"><link rel="prefetch" href="/assets/js/71.4e5ce64a.js"><link rel="prefetch" href="/assets/js/72.89210c37.js"><link rel="prefetch" href="/assets/js/73.a2542c1a.js"><link rel="prefetch" href="/assets/js/74.3c9d3f1b.js"><link rel="prefetch" href="/assets/js/75.da0a95a0.js"><link rel="prefetch" href="/assets/js/76.4168cd26.js"><link rel="prefetch" href="/assets/js/77.1ee95342.js"><link rel="prefetch" href="/assets/js/78.35f2ef39.js"><link rel="prefetch" href="/assets/js/79.c8518e07.js"><link rel="prefetch" href="/assets/js/8.31f9acca.js"><link rel="prefetch" href="/assets/js/80.8b2bf30b.js"><link rel="prefetch" href="/assets/js/81.f1537b64.js"><link rel="prefetch" href="/assets/js/82.82d19909.js"><link rel="prefetch" href="/assets/js/83.dfc28a79.js"><link rel="prefetch" href="/assets/js/84.a289c030.js"><link rel="prefetch" href="/assets/js/85.d1aa5612.js"><link rel="prefetch" href="/assets/js/86.6c7412d6.js"><link rel="prefetch" href="/assets/js/87.f9b887f7.js"><link rel="prefetch" href="/assets/js/88.19f423af.js"><link rel="prefetch" href="/assets/js/89.ebc19a45.js"><link rel="prefetch" href="/assets/js/9.d2ef661a.js"><link rel="prefetch" href="/assets/js/90.39834eaa.js"><link rel="prefetch" href="/assets/js/91.dee61774.js"><link rel="prefetch" href="/assets/js/92.e2a4afd1.js"><link rel="prefetch" href="/assets/js/93.951d933c.js"><link rel="prefetch" href="/assets/js/94.d1b74c74.js"><link rel="prefetch" href="/assets/js/95.b15eb61a.js"><link rel="prefetch" href="/assets/js/96.10581589.js"><link rel="prefetch" href="/assets/js/97.a437eaf2.js"><link rel="prefetch" href="/assets/js/98.4fb5e190.js"><link rel="prefetch" href="/assets/js/99.f859d5b5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e687256a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Ailjc notes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/Js/" class="nav-link">Js</a></div><div class="nav-item"><a href="/react/" class="nav-link">React</a></div><div class="nav-item"><a href="/vuebase/" class="nav-link router-link-active">快速掌握Vue</a></div><div class="nav-item"><a href="/node/" class="nav-link">Node</a></div><div class="nav-item"><a href="/typescript/" class="nav-link">Typescript</a></div><div class="nav-item"><a href="/vue3/" class="nav-link">Vue3</a></div><div class="nav-item"><a href="/vuesourcecode/" class="nav-link">源码分析</a></div><div class="nav-item"><a href="/lu-ui/" class="nav-link">组件库</a></div><div class="nav-item"><a href="/engineering/" class="nav-link">工程化</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/Js/" class="nav-link">Js</a></div><div class="nav-item"><a href="/react/" class="nav-link">React</a></div><div class="nav-item"><a href="/vuebase/" class="nav-link router-link-active">快速掌握Vue</a></div><div class="nav-item"><a href="/node/" class="nav-link">Node</a></div><div class="nav-item"><a href="/typescript/" class="nav-link">Typescript</a></div><div class="nav-item"><a href="/vue3/" class="nav-link">Vue3</a></div><div class="nav-item"><a href="/vuesourcecode/" class="nav-link">源码分析</a></div><div class="nav-item"><a href="/lu-ui/" class="nav-link">组件库</a></div><div class="nav-item"><a href="/engineering/" class="nav-link">工程化</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/vuebase/前端自动化测试/" class="sidebar-heading clickable"><span>前端自动化测试</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/vuebase/进阶篇/" class="sidebar-heading clickable"><span>进阶篇</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/vuebase/面试题/" class="sidebar-heading clickable open"><span>面试题</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/vuebase/面试题/01-Prepare.html" class="sidebar-link">01-Prepare</a></li><li><a href="/vuebase/面试题/02-Prepare.html" class="sidebar-link">02-Prepare</a></li><li><a href="/vuebase/面试题/03-源码相关.html" class="active sidebar-link">03-源码相关</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuebase/面试题/03-源码相关.html#_1-vue-的初始化过程-new-vue-options-都做了什么" class="sidebar-link">1. Vue 的初始化过程（new Vue(options)）都做了什么？</a></li><li class="sidebar-sub-header"><a href="/vuebase/面试题/03-源码相关.html#_2-vue-响应式原理是怎么实现的" class="sidebar-link">2. Vue 响应式原理是怎么实现的？</a></li><li class="sidebar-sub-header"><a href="/vuebase/面试题/03-源码相关.html#_3-methods、computed-和-watch-有什么区别" class="sidebar-link">3. methods、computed 和 watch 有什么区别？</a></li><li class="sidebar-sub-header"><a href="/vuebase/面试题/03-源码相关.html#_4-vue-的异步更新机制是如何实现的" class="sidebar-link">4. Vue 的异步更新机制是如何实现的？</a></li><li class="sidebar-sub-header"><a href="/vuebase/面试题/03-源码相关.html#_5-vue-的-nexttick-api-是如何实现的" class="sidebar-link">5. Vue 的 nextTick API 是如何实现的？</a></li><li class="sidebar-sub-header"><a href="/vuebase/面试题/03-源码相关.html#_6-全局-api" class="sidebar-link">6. 全局 API</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuebase/面试题/03-源码相关.html#_1-vue-use-plugin-做了什么" class="sidebar-link">1. Vue.use(plugin) 做了什么？</a></li><li class="sidebar-sub-header"><a href="/vuebase/面试题/03-源码相关.html#_2-vue-mixin-options-做了什么" class="sidebar-link">2. Vue.mixin(options) 做了什么？</a></li><li class="sidebar-sub-header"><a href="/vuebase/面试题/03-源码相关.html#_3-vue-component-compname-comp-做了什么" class="sidebar-link">3. Vue.component(compName, Comp) 做了什么？</a></li><li class="sidebar-sub-header"><a href="/vuebase/面试题/03-源码相关.html#_4-vue-directive-my-directive-xx-做了什么" class="sidebar-link">4. Vue.directive('my-directive', {xx}) 做了什么？</a></li><li class="sidebar-sub-header"><a href="/vuebase/面试题/03-源码相关.html#_5-vue-filter-my-filter-function-val-xx-做了什么" class="sidebar-link">5. Vue.filter('my-filter', function(val) {xx}) 做了什么？</a></li><li class="sidebar-sub-header"><a href="/vuebase/面试题/03-源码相关.html#_6-vue-extend-options-做了什么" class="sidebar-link">6. Vue.extend(options) 做了什么？</a></li><li class="sidebar-sub-header"><a href="/vuebase/面试题/03-源码相关.html#_7-vue-set-target-key-val-做了什么" class="sidebar-link">7. Vue.set(target, key, val) 做了什么</a></li><li class="sidebar-sub-header"><a href="/vuebase/面试题/03-源码相关.html#_8-vue-delete-target-key-做了什么" class="sidebar-link">8. Vue.delete(target, key) 做了什么？</a></li><li class="sidebar-sub-header"><a href="/vuebase/面试题/03-源码相关.html#_9-vue-nexttick-cb-做了什么" class="sidebar-link">9. Vue.nextTick(cb) 做了什么？</a></li></ul></li><li class="sidebar-sub-header"><a href="/vuebase/面试题/03-源码相关.html#_7-实例方法" class="sidebar-link">7. 实例方法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuebase/面试题/03-源码相关.html#_1-vm-set-obj-key-val-做了什么" class="sidebar-link">1. vm.\$set(obj, key, val) 做了什么？</a></li><li class="sidebar-sub-header"><a href="/vuebase/面试题/03-源码相关.html#_2-vm-delete-obj-key-做了什么" class="sidebar-link">2. vm.\$delete(obj, key) 做了什么？</a></li><li class="sidebar-sub-header"><a href="/vuebase/面试题/03-源码相关.html#_3-vm-watch-exporfn-callback-options-做了什么" class="sidebar-link">3. vm.$watch(expOrFn, callback, [options]) 做了什么？</a></li><li class="sidebar-sub-header"><a href="/vuebase/面试题/03-源码相关.html#_4-vm-on-event-callback-做了什么" class="sidebar-link">4. vm.\$on(event, callback) 做了什么？</a></li><li class="sidebar-sub-header"><a href="/vuebase/面试题/03-源码相关.html#_5-vm-emit-eventname-args-做了什么" class="sidebar-link">5. vm.\$emit(eventName, [...args]) 做了什么？</a></li><li class="sidebar-sub-header"><a href="/vuebase/面试题/03-源码相关.html#_6-vm-off-event-callback-做了什么" class="sidebar-link">6. vm.\$off([event, callback]) 做了什么？</a></li><li class="sidebar-sub-header"><a href="/vuebase/面试题/03-源码相关.html#_7-vm-once-event-callback-做了什么" class="sidebar-link">7. vm.\$once(event, callback) 做了什么？</a></li><li class="sidebar-sub-header"><a href="/vuebase/面试题/03-源码相关.html#_8-vm-update-vnode-hydrating-做了什么" class="sidebar-link">8. vm._update(vnode, hydrating) 做了什么？</a></li><li class="sidebar-sub-header"><a href="/vuebase/面试题/03-源码相关.html#_9-vm-forceupdate-做了什么" class="sidebar-link">9. vm.\$forceUpdate() 做了什么？</a></li><li class="sidebar-sub-header"><a href="/vuebase/面试题/03-源码相关.html#_10-vm-destroy-做了什么" class="sidebar-link">10. vm.\$destroy() 做了什么？</a></li><li class="sidebar-sub-header"><a href="/vuebase/面试题/03-源码相关.html#_11-vm-nexttick-cb-做了什么" class="sidebar-link">11. vm.\$nextTick(cb) 做了什么？</a></li><li class="sidebar-sub-header"><a href="/vuebase/面试题/03-源码相关.html#_12-vm-render-做了什么" class="sidebar-link">12. vm._render 做了什么？</a></li></ul></li><li class="sidebar-sub-header"><a href="/vuebase/面试题/03-源码相关.html#_8-hook-event" class="sidebar-link">8. Hook Event</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuebase/面试题/03-源码相关.html#_1-什么是-hook-event" class="sidebar-link">1. 什么是 Hook Event？</a></li><li class="sidebar-sub-header"><a href="/vuebase/面试题/03-源码相关.html#_2-hook-event-是如果实现的" class="sidebar-link">2. Hook Event 是如果实现的？</a></li></ul></li><li class="sidebar-sub-header"><a href="/vuebase/面试题/03-源码相关.html#_9-编译器" class="sidebar-link">9. 编译器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuebase/面试题/03-源码相关.html#_1-简单说一下-vue-的编译器都做了什么" class="sidebar-link">1. 简单说一下 Vue 的编译器都做了什么？</a></li><li class="sidebar-sub-header"><a href="/vuebase/面试题/03-源码相关.html#_2-详细说一下静态标记的过程" class="sidebar-link">2. 详细说一下静态标记的过程</a></li><li class="sidebar-sub-header"><a href="/vuebase/面试题/03-源码相关.html#_3-什么样的节点才可以被标记为静态节点" class="sidebar-link">3. 什么样的节点才可以被标记为静态节点？</a></li><li class="sidebar-sub-header"><a href="/vuebase/面试题/03-源码相关.html#_4-详细说一下渲染函数的生成过程" class="sidebar-link">4. 详细说一下渲染函数的生成过程</a></li><li class="sidebar-sub-header"><a href="/vuebase/面试题/03-源码相关.html#_5-静态节点是怎么处理的" class="sidebar-link">5. 静态节点是怎么处理的</a></li><li class="sidebar-sub-header"><a href="/vuebase/面试题/03-源码相关.html#_6-v-once、v-if、v-for、组件-等都是怎么处理的" class="sidebar-link">6. v-once、v-if、v-for、组件 等都是怎么处理的</a></li><li class="sidebar-sub-header"><a href="/vuebase/面试题/03-源码相关.html#_7-other" class="sidebar-link">7. other</a></li></ul></li><li class="sidebar-sub-header"><a href="/vuebase/面试题/03-源码相关.html#_10-一个组件是如何变成-vnode" class="sidebar-link">10. 一个组件是如何变成 VNode？</a></li><li class="sidebar-sub-header"><a href="/vuebase/面试题/03-源码相关.html#_11-你能说一说-vue-的-patch-算法吗" class="sidebar-link">11. 你能说一说 Vue 的 patch 算法吗？</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/vuebase/项目实战/" class="sidebar-heading clickable"><span>项目实战</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="源码相关"><a href="#源码相关" class="header-anchor">#</a> 源码相关</h1> <p></p><div class="table-of-contents"><ul><li><a href="#_1-vue-的初始化过程-new-vue-options-都做了什么">1. Vue 的初始化过程（new Vue(options)）都做了什么？</a></li><li><a href="#_2-vue-响应式原理是怎么实现的">2. Vue 响应式原理是怎么实现的？</a></li><li><a href="#_3-methods、computed-和-watch-有什么区别">3. methods、computed 和 watch 有什么区别？</a></li><li><a href="#_4-vue-的异步更新机制是如何实现的">4. Vue 的异步更新机制是如何实现的？</a></li><li><a href="#_5-vue-的-nexttick-api-是如何实现的">5. Vue 的 nextTick API 是如何实现的？</a></li><li><a href="#_6-全局-api">6. 全局 API</a><ul><li><a href="#_1-vue-use-plugin-做了什么">1. Vue.use(plugin) 做了什么？</a></li><li><a href="#_2-vue-mixin-options-做了什么">2. Vue.mixin(options) 做了什么？</a></li><li><a href="#_3-vue-component-compname-comp-做了什么">3. Vue.component(compName, Comp) 做了什么？</a></li><li><a href="#_4-vue-directive-my-directive-xx-做了什么">4. Vue.directive('my-directive', {xx}) 做了什么？</a></li><li><a href="#_5-vue-filter-my-filter-function-val-xx-做了什么">5. Vue.filter('my-filter', function(val) {xx}) 做了什么？</a></li><li><a href="#_6-vue-extend-options-做了什么">6. Vue.extend(options) 做了什么？</a></li><li><a href="#_7-vue-set-target-key-val-做了什么">7. Vue.set(target, key, val) 做了什么</a></li><li><a href="#_8-vue-delete-target-key-做了什么">8. Vue.delete(target, key) 做了什么？</a></li><li><a href="#_9-vue-nexttick-cb-做了什么">9. Vue.nextTick(cb) 做了什么？</a></li></ul></li><li><a href="#_7-实例方法">7. 实例方法</a><ul><li><a href="#_1-vm-set-obj-key-val-做了什么">1. vm.\$set(obj, key, val) 做了什么？</a></li><li><a href="#_2-vm-delete-obj-key-做了什么">2. vm.\$delete(obj, key) 做了什么？</a></li><li><a href="#_3-vm-watch-exporfn-callback-options-做了什么">3. vm.$watch(expOrFn, callback, [options]) 做了什么？</a></li><li><a href="#_4-vm-on-event-callback-做了什么">4. vm.\$on(event, callback) 做了什么？</a></li><li><a href="#_5-vm-emit-eventname-args-做了什么">5. vm.\$emit(eventName, [...args]) 做了什么？</a></li><li><a href="#_6-vm-off-event-callback-做了什么">6. vm.\$off([event, callback]) 做了什么？</a></li><li><a href="#_7-vm-once-event-callback-做了什么">7. vm.\$once(event, callback) 做了什么？</a></li><li><a href="#_8-vm-update-vnode-hydrating-做了什么">8. vm._update(vnode, hydrating) 做了什么？</a></li><li><a href="#_9-vm-forceupdate-做了什么">9. vm.\$forceUpdate() 做了什么？</a></li><li><a href="#_10-vm-destroy-做了什么">10. vm.\$destroy() 做了什么？</a></li><li><a href="#_11-vm-nexttick-cb-做了什么">11. vm.\$nextTick(cb) 做了什么？</a></li><li><a href="#_12-vm-render-做了什么">12. vm._render 做了什么？</a></li></ul></li><li><a href="#_8-hook-event">8. Hook Event</a><ul><li><a href="#_1-什么是-hook-event">1. 什么是 Hook Event？</a></li><li><a href="#_2-hook-event-是如果实现的">2. Hook Event 是如果实现的？</a></li></ul></li><li><a href="#_9-编译器">9. 编译器</a><ul><li><a href="#_1-简单说一下-vue-的编译器都做了什么">1. 简单说一下 Vue 的编译器都做了什么？</a></li><li><a href="#_2-详细说一下静态标记的过程">2. 详细说一下静态标记的过程</a></li><li><a href="#_3-什么样的节点才可以被标记为静态节点">3. 什么样的节点才可以被标记为静态节点？</a></li><li><a href="#_4-详细说一下渲染函数的生成过程">4. 详细说一下渲染函数的生成过程</a></li><li><a href="#_5-静态节点是怎么处理的">5. 静态节点是怎么处理的</a></li><li><a href="#_6-v-once、v-if、v-for、组件-等都是怎么处理的">6. v-once、v-if、v-for、组件 等都是怎么处理的</a></li><li><a href="#_7-other">7. other</a></li></ul></li><li><a href="#_10-一个组件是如何变成-vnode">10. 一个组件是如何变成 VNode？</a></li><li><a href="#_11-你能说一说-vue-的-patch-算法吗">11. 你能说一说 Vue 的 patch 算法吗？</a></li></ul></div><p></p> <h2 id="_1-vue-的初始化过程-new-vue-options-都做了什么"><a href="#_1-vue-的初始化过程-new-vue-options-都做了什么" class="header-anchor">#</a> 1. Vue 的初始化过程（new Vue(options)）都做了什么？</h2> <ol><li>处理组件配置项
<ul><li>初始化根组件时进行了选项合并操作，将全局配置合并到根组件的局部配置上</li> <li>初始化每个子组件时做了一些性能优化，将组件配置对象上的一些深层次属性放到 vm.$options 选项中，以提高代码的执行效率</li></ul></li> <li>初始化组件实例的关系属性，比如 $parent、$children、$root、$refs 等</li> <li>处理自定义事件</li> <li>调用 <code>beforeCreate</code> 钩子函数</li> <li>初始化组件的 inject 配置项，得到 <code>ret[key] = val</code> 形式的配置对象，然后对该配置对象进行浅层的响应式处理（只处理了对象第一层数据），并代理每个 key 到 vm 实例上</li> <li>数据响应式，处理 props、methods、data、computed、watch 等选项</li> <li>解析组件配置项上的 provide 对象，将其挂载到 <code>vm._provided</code> 属性上</li> <li>调用 created 钩子函数</li> <li>如果发现配置项上有 el 选项，则自动调用 $mount 方法，也就是说有了 el 选项，就不需要再手动调用 $mount 方法，反之，没提供 el 选项则必须调用 $mount</li> <li>接下来则进入挂载阶段</li></ol> <h2 id="_2-vue-响应式原理是怎么实现的"><a href="#_2-vue-响应式原理是怎么实现的" class="header-anchor">#</a> 2. Vue 响应式原理是怎么实现的？</h2> <p>响应式的核心是通过 <code>Object.defineProperty</code> 拦截对数据的访问和设置<br>
响应式的数据分为两类：</p> <ol><li>对象，循环遍历对象的所有属性，为每个属性设置 getter、setter，以达到拦截访问和设置的目的，如果属性值依旧为对象，则递归为属性值上的每个 key 设置 getter、setter
<ul><li>访问数据时（obj.key)进行依赖收集，在 dep 中存储相关的 watcher</li> <li>设置数据时由 dep 通知相关的 watcher 去更新</li></ul></li> <li>数组，增强数组的那 7 个可以更改自身的原型方法，然后拦截对这些方法的操作
<ul><li>添加新数据时进行响应式处理，然后由 dep 通知 watcher 去更新</li> <li>删除数据时，也要由 dep 通知 watcher 去更新</li></ul></li></ol> <h2 id="_3-methods、computed-和-watch-有什么区别"><a href="#_3-methods、computed-和-watch-有什么区别" class="header-anchor">#</a> 3. methods、computed 和 watch 有什么区别？</h2> <p>示例</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>methods、computed、watch 有什么区别<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token comment">&lt;!-- methods --&gt;</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>{{ returnMsg() }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>{{ returnMsg() }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token comment">&lt;!-- computed --&gt;</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>{{ getMsg }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>{{ getMsg }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>../../dist/vue.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
      <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">el</span><span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">'test'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>msg <span class="token operator">=</span> <span class="token string">'msg is changed'</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token function">returnMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'methods: returnMsg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>msg<span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">computed</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token function">getMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'computed: getMsg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>msg <span class="token operator">+</span> <span class="token string">' hello computed'</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">watch</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token function-variable function">msg</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">val<span class="token punctuation">,</span> oldVal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'watch: msg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>msg <span class="token operator">=</span> <span class="token string">'msg is changed by watch'</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div><p>使用场景</p> <ul><li><code>methods</code> 一般用于封装一些较为复杂的处理逻辑（同步、异步）</li> <li><code>computed</code> 一般用于封装一些简单的同步逻辑，将经过处理的数据返回，然后显示在模版中，以减轻模版的重量</li> <li><code>watch</code> 一般用于当需要在数据变化时执行异步或开销较大的操作</li></ul> <p>区别</p> <ul><li>methods VS computed
<ul><li>通过示例会发现，如果在一次渲染中，有多个地方使用了同一个 methods 或 computed 属性，methods 会被执行多次，而 computed 的回调函数则只会被执行一次。</li> <li>通过阅读源码我们知道，在一次渲染中，多次访问 computedProperty，只会在第一次执行 computed 属性的回调函数，后续的其它访问，则直接使用第一次的执行结果（watcher.value），而这一切的实现原理则是通过对 watcher.dirty 属性的控制实现的。而 methods，每一次的访问则是简单的方法调用（this.xxMethods）。</li></ul></li> <li>computed VS watch
<ul><li>通过阅读源码我们知道，computed 和 watch 的本质是一样的，内部都是通过 Watcher 来实现的，其实没什么区别，非要说区别的化就两点：1、使用场景上的区别，2、computed 默认是懒执行的，切不可更改。</li></ul></li> <li>methods VS watch
<ul><li>methods 和 watch 之间其实没什么可比的，完全是两个东西，不过在使用上可以把 watch 中一些逻辑抽到 methods 中，提高代码的可读性。</li></ul></li></ul> <h2 id="_4-vue-的异步更新机制是如何实现的"><a href="#_4-vue-的异步更新机制是如何实现的" class="header-anchor">#</a> 4. Vue 的异步更新机制是如何实现的？</h2> <p>Vue 的异步更新机制的核心是利用了浏览器的异步任务队列来实现的，首选微任务队列，宏任务队列次之。<br>
当响应式数据更新后，会调用 <code>dep.notify</code> 方法，通知 <code>dep</code> 中收集的 <code>watcher</code> 去执行 <code>update</code> 方法，<code>watcher.update</code> 将 <code>watcher</code> 自己放入一个 <code>watcher</code> 队列（全局的 queue 数组）。<br>
然后通过 nextTick 方法将一个刷新 <code>watcher</code> 队列的方法（flushSchedulerQueue）放入一个全局的 callbacks 数组中。<br>
如果此时浏览器的异步任务队列中没有一个叫 <code>flushCallbacks</code> 的函数，则执行 timerFunc 函数，将 <code>flushCallbacks</code> 函数放入异步任务队列。如果异步任务队列中已经存在 <code>flushCallbacks</code> 函数，等待其执行完成以后再放入下一个 <code>flushCallbacks</code> 函数。<br> <code>flushCallbacks</code> 函数负责执行 <code>callbacks</code> 数组中的所有 <code>flushSchedulerQueue</code> 函数。<br> <code>flushSchedulerQueue</code> 函数负责刷新 <code>watcher</code> 队列，即执行 <code>queue</code> 数组中每一个 <code>watcher</code> 的 <code>run</code> 方法，从而进入更新阶段，比如执行组件更新函数或者执行用户 <code>watch</code> 的回调函数。</p> <h2 id="_5-vue-的-nexttick-api-是如何实现的"><a href="#_5-vue-的-nexttick-api-是如何实现的" class="header-anchor">#</a> 5. Vue 的 nextTick API 是如何实现的？</h2> <p><code>Vue.nextTick</code> 或者 <code>vm.$nextTick</code> 的原理其实很简单，就做了两件事：</p> <ol><li>将传递的回调函数用 <code>try catch</code> 包裹然后放入 <code>callbacks</code> 数组</li> <li>执行 <code>timerFunc</code> 函数，在浏览器的异步任务队列放入一个刷新 <code>callbacks</code> 数组的函数</li></ol> <h2 id="_6-全局-api"><a href="#_6-全局-api" class="header-anchor">#</a> 6. 全局 API</h2> <h3 id="_1-vue-use-plugin-做了什么"><a href="#_1-vue-use-plugin-做了什么" class="header-anchor">#</a> 1. Vue.use(plugin) 做了什么？</h3> <p>负责安装 <code>plugin</code> 插件，其实就是执行插件提供的 <code>install</code> 方法。</p> <ul><li>首先判断该插件是否已经安装过</li> <li>如果没有，则执行插件提供的 <code>install</code> 方法安装插件，具体做什么有插件自己决定</li></ul> <h3 id="_2-vue-mixin-options-做了什么"><a href="#_2-vue-mixin-options-做了什么" class="header-anchor">#</a> 2. Vue.mixin(options) 做了什么？</h3> <p>负责在 Vue 的全局配置上合并 <code>options</code> 配置。然后在每个组件生成 <code>vnode</code> 时会将全局配置合并到组件自身的配置上来。</p> <ul><li>标准化 <code>options</code> 对象上的 <code>props</code>、<code>inject</code>、<code>directive</code> 选项的格式</li> <li>处理 <code>options</code> 上的 <code>extends</code> 和 <code>mixins</code>，分别将他们合并到全局配置上</li> <li>然后将 <code>options</code> 配置和全局配置进行合并，选项冲突时 <code>options</code> 配置会覆盖全局配置</li></ul> <h3 id="_3-vue-component-compname-comp-做了什么"><a href="#_3-vue-component-compname-comp-做了什么" class="header-anchor">#</a> 3. Vue.component(compName, Comp) 做了什么？</h3> <p>负责注册全局组件。其实就是将组件配置注册到全局配置的 components 选项上（options.components），然后各个子组件在生成 vnode 时会将全局的 components 选项合并到局部的 components 配置项上。</p> <ul><li>如果第二个参数为空，则表示获取 compName 的组件构造函数</li> <li>如果 Comp 是组件配置对象，则使用 Vue.extend 方法得到组件构造函数，否则直接进行下一步</li> <li>在全局配置上设置组件信息，this.options.components.compName = CompConstructor</li></ul> <h3 id="_4-vue-directive-my-directive-xx-做了什么"><a href="#_4-vue-directive-my-directive-xx-做了什么" class="header-anchor">#</a> 4. Vue.directive('my-directive', {xx}) 做了什么？</h3> <p>在全局注册 my-directive 指令，然后每个子组件在生成 vnode 时会将全局的 directives 选项合并到局部的 directives 选项中。原理同 Vue.component 方法：</p> <ul><li>如果第二个参数为空，则获取指定指令的配置对象</li> <li>如果不为空，如果第二个参数是一个函数的话，则生成配置对象 { bind: 第二个参数, update: 第二个参数 }</li> <li>然后将指令配置对象设置到全局配置上，<code>this.options.directives['my-directive'] = {xx}</code></li></ul> <h3 id="_5-vue-filter-my-filter-function-val-xx-做了什么"><a href="#_5-vue-filter-my-filter-function-val-xx-做了什么" class="header-anchor">#</a> 5. Vue.filter('my-filter', function(val) {xx}) 做了什么？</h3> <p>负责在全局注册过滤器 my-filter，然后每个子组件在生成 vnode 时会将全局的 filters 选项合并到局部的 filters 选项中。原理是：</p> <ul><li>如果没有提供第二个参数，则获取 my-filter 过滤器的回调函数</li> <li>如果提供了第二个参数，则是设置 <code>this.options.filters['my-filter'] = function(val) {xx}</code>。</li></ul> <h3 id="_6-vue-extend-options-做了什么"><a href="#_6-vue-extend-options-做了什么" class="header-anchor">#</a> 6. Vue.extend(options) 做了什么？</h3> <p><code>Vue.extend</code> 基于 Vue 创建一个子类，参数 options 会作为该子类的默认全局配置，就像 Vue 的默认全局配置一样。所以通过 Vue.extend 扩展一个子类，一大用处就是内置一些公共配置，供子类的子类使用。</p> <ul><li>定义子类构造函数，这里和 Vue 一样，也是调用 <code>_init(options)</code></li> <li>合并 Vue 的配置和 <code>options</code>，如果选项冲突，则 <code>options</code> 的选项会覆盖 Vue 的配置项</li> <li>给子类定义全局 API，值为 Vue 的全局 API，比如 <code>Sub.extend = Super.extend</code>，这样子类同样可以扩展出其它子类</li> <li>返回子类 Sub</li></ul> <h3 id="_7-vue-set-target-key-val-做了什么"><a href="#_7-vue-set-target-key-val-做了什么" class="header-anchor">#</a> 7. Vue.set(target, key, val) 做了什么</h3> <p>由于 Vue 无法探测普通的新增 property (比如 this.myObject.newProperty = 'hi')，所以通过 Vue.set 为向响应式对象中添加一个 property，可以确保这个新 property 同样是响应式的，且触发视图更新。</p> <ul><li>更新数组指定下标的元素：<code>Vue.set(array, idx, val)</code>，内部通过 <code>splice</code> 方法实现响应式更新</li> <li>更新对象已有属性：<code>Vue.set(obj, key ,val)</code>，直接更新即可 <code>=&gt; obj[key] = val</code></li> <li>不能向 Vue 实例或者 <code>$data</code> 动态添加根级别的响应式数据</li> <li><code>Vue.set(obj, key, val)</code>，如果 obj 不是响应式对象，会执行 <code>obj[key] = val</code>，但是不会做响应式处理</li> <li><code>Vue.set(obj, key, val)</code>，为响应式对象 obj 增加一个新的 key，则通过 <code>defineReactive</code> 方法设置响应式，并触发依赖更新</li></ul> <h3 id="_8-vue-delete-target-key-做了什么"><a href="#_8-vue-delete-target-key-做了什么" class="header-anchor">#</a> 8. Vue.delete(target, key) 做了什么？</h3> <p>删除对象的 property。如果对象是响应式的，确保删除能触发更新视图。这个方法主要用于避开 Vue 不能检测到 property 被删除的限制，但是你应该很少会使用它。当然同样不能删除根级别的响应式属性。</p> <ul><li><code>Vue.delete(array, idx)</code>，删除指定下标的元素，内部是通过 <code>splice</code> 方法实现的</li> <li>删除响应式对象上的某个属性：<code>Vue.delete(obj, key)</code>，内部是执行 <code>delete obj.key</code>，然后执行依赖更新即可</li></ul> <h3 id="_9-vue-nexttick-cb-做了什么"><a href="#_9-vue-nexttick-cb-做了什么" class="header-anchor">#</a> 9. Vue.nextTick(cb) 做了什么？</h3> <p><code>Vue.nextTick(cb)</code> 方法的作用是延迟回调函数 cb 的执行，一般用于 <code>this.key = newVal</code> 更改数据后，想立即获取更改过后的 DOM 数据：<code>this.key = 'new val'</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>Vue<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// DOM 更新了</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>其内部的执行过程是：</p> <ul><li><code>this.key = 'new val</code>，触发依赖通知更新，将负责更新的 <code>watcher</code> 放入 <code>watcher</code> 队列</li> <li>将刷新 <code>watcher</code> 队列的函数放到 <code>callbacks</code> 数组中</li> <li>在浏览器的异步任务队列中放入一个刷新 <code>callbacks</code> 数组的函数</li> <li><code>Vue.nextTick(cb)</code> 来插队，将 <code>cb</code> 函数放入 <code>callbacks</code> 数组</li> <li>待将来的某个时刻执行刷新 <code>callbacks</code> 数组的函数</li> <li>然后执行 callbacks 数组中的众多函数，触发 watcher.run 的执行，更新 DOM</li> <li>由于 cb 函数是在后面放到 callbacks 数组，所以这就保证了先完成的 DOM 更新，再执行 cb 函数</li></ul> <h2 id="_7-实例方法"><a href="#_7-实例方法" class="header-anchor">#</a> 7. 实例方法</h2> <h3 id="_1-vm-set-obj-key-val-做了什么"><a href="#_1-vm-set-obj-key-val-做了什么" class="header-anchor">#</a> 1. vm.$set(obj, key, val) 做了什么？</h3> <p><code>vm.$set</code> 用于向响应式对象添加一个新的 property，并确保这个新的 property 同样是响应式的，并触发视图更新。由于 Vue 无法探测对象新增属性或者通过索引为数组新增一个元素，比如：this.obj.newProperty = 'val'、this.arr[3] = 'val'。所以这才有了 <code>vm.$set</code>，它是 <code>Vue.set</code> 的别名。</p> <ul><li>为对象添加一个新的响应式数据：调用 defineReactive 方法为对象增加响应式数据，然后执行 dep.notify 进行依赖通知，更新视图</li> <li>为数组添加一个新的响应式数据：通过 splice 方法实现</li></ul> <h3 id="_2-vm-delete-obj-key-做了什么"><a href="#_2-vm-delete-obj-key-做了什么" class="header-anchor">#</a> 2. vm.$delete(obj, key) 做了什么？</h3> <p><code>vm.$delete</code> 用于删除对象上的属性。如果对象是响应式的，且能确保能触发视图更新。该方法主要用于避开 Vue 不能检测属性被删除的情况。它是 Vue.delete 的别名。</p> <ul><li>删除数组指定下标的元素，内部通过 splice 方法来完成</li> <li>删除对象上的指定属性，则是先通过 delete 运算符删除该属性，然后执行 dep.notify 进行依赖通知，更新视图</li></ul> <h3 id="_3-vm-watch-exporfn-callback-options-做了什么"><a href="#_3-vm-watch-exporfn-callback-options-做了什么" class="header-anchor">#</a> 3. <code>vm.$watch(expOrFn, callback, [options])</code> 做了什么？</h3> <p><code>vm.$watch</code> 负责观察 Vue 实例上的一个表达式或者一个函数计算结果的变化。当其发生变化时，回调函数就会被执行，并为回调函数传递两个参数，第一个为更新后的新值，第二个为老值。</p> <p>这里需要 注意 一点的是：如果观察的是一个对象，比如：数组，当你用数组方法，比如 push 为数组新增一个元素时，回调函数被触发时传递的新值和老值相同，因为它们指向同一个引用，所以在观察一个对象并且在回调函数中有新老值是否相等的判断时需要注意。</p> <p><code>vm.$watch</code> 的第一个参数只接收简单的响应式数据的键路径，对于更复杂的表达式建议使用函数作为第一个参数。</p> <p>至于 <code>vm.$watch</code> 的内部原理是：</p> <ul><li>设置 <code>options.user = true</code>，标志是一个用户 <code>watcher</code></li> <li>实例化一个 <code>Watcher</code> 实例，当检测到数据更新时，通过 <code>watcher</code> 去触发回调函数的执行，并传递新老值作为回调函数的参数</li> <li>返回一个 <code>unwatch</code> 函数，用于取消观察</li></ul> <h3 id="_4-vm-on-event-callback-做了什么"><a href="#_4-vm-on-event-callback-做了什么" class="header-anchor">#</a> 4. vm.$on(event, callback) 做了什么？</h3> <p>监听当前实例上的自定义事件，事件可由 vm.$emit 触发，回调函数会接收所有传入事件触发函数（vm.$emit）的额外参数。</p> <p><code>vm.$on</code> 的原理很简单，就是处理传递的 event 和 callback 两个参数，将注册的事件和回调函数以键值对的形式存储到 vm._event 对象中，vm._events = { eventName: [cb1, cb2, ...], ... }。</p> <h3 id="_5-vm-emit-eventname-args-做了什么"><a href="#_5-vm-emit-eventname-args-做了什么" class="header-anchor">#</a> 5. vm.$emit(eventName, [...args]) 做了什么？</h3> <p>触发当前实例上的指定事件，附加参数都会传递给事件的回调函数。</p> <p>其内部原理就是执行 <code>vm._events[eventName]</code> 中所有的回调函数。</p> <h3 id="_6-vm-off-event-callback-做了什么"><a href="#_6-vm-off-event-callback-做了什么" class="header-anchor">#</a> 6. vm.$off([event, callback]) 做了什么？</h3> <p>移除自定义事件监听器，即移除 vm._events 对象上相关数据。</p> <ul><li>如果没有提供参数，则移除实例的所有事件监听</li> <li>如果只提供了 event 参数，则移除实例上该事件的所有监听器</li> <li>如果两个参数都提供了，则移除实例上该事件对应的监听器</li></ul> <h3 id="_7-vm-once-event-callback-做了什么"><a href="#_7-vm-once-event-callback-做了什么" class="header-anchor">#</a> 7. vm.$once(event, callback) 做了什么？</h3> <p>监听一个自定义事件，但是该事件只会被触发一次。一旦触发以后监听器就会被移除。</p> <p>其内部的实现原理是：</p> <ul><li>包装用户传递的回调函数，当包装函数执行的时候，除了会执行用户回调函数之外还会执行 <code>vm.$off(event, 包装函数)</code> 移除该事件</li> <li>用 <code>vm.$on(event, 包装函数)</code> 注册事件</li></ul> <h3 id="_8-vm-update-vnode-hydrating-做了什么"><a href="#_8-vm-update-vnode-hydrating-做了什么" class="header-anchor">#</a> 8. vm._update(vnode, hydrating) 做了什么？</h3> <p>官方文档没有说明该 API，这是一个用于源码内部的实例方法，负责更新页面，是页面渲染的入口，其内部根据是否存在 prevVnode 来决定是首次渲染，还是页面更新，从而在调用 <code>__patch__</code> 函数时传递不同的参数。该方法在业务开发中不会用到。</p> <h3 id="_9-vm-forceupdate-做了什么"><a href="#_9-vm-forceupdate-做了什么" class="header-anchor">#</a> 9. vm.$forceUpdate() 做了什么？</h3> <p>迫使 Vue 实例重新渲染，它仅仅影响组件实例本身和插入插槽内容的子组件，而不是所有子组件。其内部原理到也简单，就是直接调用 <code>vm._watcher.update()</code>，它就是 <code>watcher.update()</code> 方法，执行该方法触发组件更新。</p> <h3 id="_10-vm-destroy-做了什么"><a href="#_10-vm-destroy-做了什么" class="header-anchor">#</a> 10. vm.$destroy() 做了什么？</h3> <p>负责完全销毁一个实例。清理它与其它实例的连接，解绑它的全部指令和事件监听器。在执行过程中会调用 <code>beforeDestroy</code> 和 <code>destroy</code> 两个钩子函数。在大多数业务开发场景下用不到该方法，一般都通过 <code>v-if</code> 指令来操作。</p> <p>其内部原理是：</p> <ul><li>调用 <code>beforeDestroy</code> 钩子函数</li> <li>将自己从老爹肚子里（$parent）移除，从而销毁和老爹的关系</li> <li>通过 <code>watcher.teardown()</code> 来移除依赖监听</li> <li>通过 <code>vm.__patch__(vnode, null)</code> 方法来销毁节点</li> <li>调用 <code>destroyed</code> 钩子函数</li> <li>通过 <code>vm.$off</code> 方法移除所有的事件监听</li></ul> <h3 id="_11-vm-nexttick-cb-做了什么"><a href="#_11-vm-nexttick-cb-做了什么" class="header-anchor">#</a> 11. vm.$nextTick(cb) 做了什么？</h3> <p><code>vm.$nextTick</code> 是 <code>Vue.nextTick</code> 的别名，其作用是延迟回调函数 cb 的执行，一般用于 <code>this.key = newVal</code> 更改数据后，想立即获取更改过后的 DOM 数据：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span>key <span class="token operator">=</span> <span class="token string">'new val'</span><span class="token punctuation">;</span>

Vue<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// DOM 更新了</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>其内部的执行过程是：</p> <ul><li>this.key = 'new val'，触发依赖通知更新，将负责更新的 watcher 放入 watcher 队列</li> <li>将刷新 watcher 队列的函数放到 callbacks 数组中</li> <li>在浏览器的异步任务队列中放入一个刷新 callbacks 数组的函数</li> <li><code>vm.$nextTick(cb)</code> 来插队，直接将 cb 函数放入 callbacks 数组</li> <li>待将来的某个时刻执行刷新 callbacks 数组的函数</li> <li>然后执行 callbacks 数组中的众多函数，触发 watcher.run 的执行，更新 DOM</li> <li>由于 cb 函数是在后面放到 callbacks 数组，所以这就保证了先完成的 DOM 更新，再执行 cb 函数</li></ul> <h3 id="_12-vm-render-做了什么"><a href="#_12-vm-render-做了什么" class="header-anchor">#</a> 12. vm._render 做了什么？</h3> <p>官方文档没有提供该方法，它是一个用于源码内部的实例方法，负责生成 vnode。其关键代码就一行，执行 render 函数生成 vnode。不过其中加了大量的异常处理代码。</p> <h2 id="_8-hook-event"><a href="#_8-hook-event" class="header-anchor">#</a> 8. Hook Event</h2> <h3 id="_1-什么是-hook-event"><a href="#_1-什么是-hook-event" class="header-anchor">#</a> 1. 什么是 Hook Event？</h3> <p>Hook Event 是 Vue 的自定义事件结合生命周期钩子实现的一种从组件外部为组件注入额外生命周期方法的功能。</p> <h3 id="_2-hook-event-是如果实现的"><a href="#_2-hook-event-是如果实现的" class="header-anchor">#</a> 2. Hook Event 是如果实现的？</h3> <div class="language-vue line-numbers-mode"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>comp</span> <span class="token attr-name"><span class="token namespace">@hook:</span>lifecycleMethod</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>method<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>处理组件自定义事件的时候（<code>vm.$on</code>) 如果发现组件有 <code>hook:xx</code> 格式的事件（xx 为 Vue 的生命周期函数），则将 <code>vm._hasHookEvent</code> 置为 true，表示该组件有 Hook Event</li> <li>在组件生命周期方法被触发的时候，内部会通过 <code>callHook</code> 方法来执行这些生命周期函数，在生命周期函数执行之后，如果发现 <code>vm._hasHookEvent</code> 为 true，则表示当前组件有 <code>Hook Event</code>，通过 <code>vm.$emit('hook:xx')</code> 触发 Hook Event 的执行</li></ul> <h2 id="_9-编译器"><a href="#_9-编译器" class="header-anchor">#</a> 9. 编译器</h2> <h3 id="_1-简单说一下-vue-的编译器都做了什么"><a href="#_1-简单说一下-vue-的编译器都做了什么" class="header-anchor">#</a> 1. 简单说一下 Vue 的编译器都做了什么？</h3> <p>Vue 的编译器做了三件事情：</p> <ol><li>将组件的 html 模版解析成 AST 对象</li> <li>优化，遍历 AST，为每个节点做静态标记，标记其是否为静态节点，然后进一步标记出静态根节点，这样在后续更新的过程中就可以跳过这些静态节点了；标记静态根用于生成渲染函数阶段，生成静态根节点的渲染函数</li> <li>从 AST 生成运行渲染函数，即大家说的 render，其实还有一个，就是 <code>staticRenderFns</code> 数组，里面存放了所有的静态节点的渲染函数</li></ol> <h3 id="_2-详细说一下静态标记的过程"><a href="#_2-详细说一下静态标记的过程" class="header-anchor">#</a> 2. 详细说一下静态标记的过程</h3> <ul><li>标记静态节点
<ul><li>通过递归的方式标记所有的元素节点</li> <li>如果节点本身是静态节点，但是存在非静态的子节点，则将节点修改为非静态节点</li></ul></li> <li>标记静态根节点，基于静态节点，进一步标记静态根节点
<ul><li>如果节点本身是静态节点 &amp;&amp; 而且有子节点 &amp;&amp; 子节点不全是文本节点，则标记为静态根节点</li> <li>如果节点本身不是静态根节点，则递归的遍历所有子节点，在子节点中标记静态根</li></ul></li></ul> <h3 id="_3-什么样的节点才可以被标记为静态节点"><a href="#_3-什么样的节点才可以被标记为静态节点" class="header-anchor">#</a> 3. 什么样的节点才可以被标记为静态节点？</h3> <ul><li>文本节点</li> <li>节点上没有 v-bind、v-for、v-if 等指令</li> <li>非组件</li></ul> <h3 id="_4-详细说一下渲染函数的生成过程"><a href="#_4-详细说一下渲染函数的生成过程" class="header-anchor">#</a> 4. 详细说一下渲染函数的生成过程</h3> <p>大家一说到渲染函数，基本上说的就是 <code>render</code> 函数，其实编译器生成的渲染有两类：</p> <ul><li>第一类就是一个 <code>render</code> 函数，负责生成动态节点的 vnode</li> <li>第二类是放在一个叫 <code>staticRenderFns</code> 数组中的静态渲染函数，这些函数负责生成静态节点的 vnode</li></ul> <p>渲染函数生成的过程，其实就是在遍历 AST 节点，通过递归的方式，处理每个节点，最后生成形如：<code>_c(tag, attr, children, normalizationType)</code> 的结果。tag 是标签名，attr 是属性对象，children 是子节点组成的数组，其中每个元素的格式都是 <code>_c(tag, attr, children, normalizationTYpe)</code> 的形式，<code>normalization</code> 表示节点的规范化类型，是一个数字 0、1、2，不重要。</p> <p>在处理 AST 节点过程中需要大家重点关注也是面试中常见的问题有：如下</p> <h3 id="_5-静态节点是怎么处理的"><a href="#_5-静态节点是怎么处理的" class="header-anchor">#</a> 5. 静态节点是怎么处理的</h3> <p>静态节点的处理分为两步：</p> <ul><li>将生成静态节点 vnode 函数放到 <code>staticRenderFns</code> 数组中</li> <li>返回一个 <code>_m(idx)</code> 的可执行函数，意思是执行 <code>staticRenderFns</code> 数组中下标为 idx 的函数，生成静态节点的 vnode</li></ul> <h3 id="_6-v-once、v-if、v-for、组件-等都是怎么处理的"><a href="#_6-v-once、v-if、v-for、组件-等都是怎么处理的" class="header-anchor">#</a> 6. v-once、v-if、v-for、组件 等都是怎么处理的</h3> <ul><li>单纯的 v-once 节点处理方式和静态节点一致</li> <li>v-if 节点的处理结果是一个三元表达式</li> <li>v-for 节点的处理结果是可执行的 <code>_l</code> 函数，该函数负责生成 v-for 节点的 vnode</li> <li>组件的处理结果和普通元素一样，得到的是形如 <code>_c(compName)</code> 的可执行代码，生成组件的 vnode</li></ul> <h3 id="_7-other"><a href="#_7-other" class="header-anchor">#</a> 7. other</h3> <p>编译器读完以后，会发现有个不明白的地方：编译器最后生成的代码都是经过 <code>with</code> 包裹的，比如:</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item in arr<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{ item }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>经过编译后生成：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">with</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">_c</span><span class="token punctuation">(</span>
    <span class="token string">'div'</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">attrs</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">'app'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">_l</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">_c</span><span class="token punctuation">(</span>
        <span class="token string">'div'</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token literal-property property">key</span><span class="token operator">:</span> item<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token function">_v</span><span class="token punctuation">(</span><span class="token function">_s</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token number">0</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>都知道，<code>with</code> 语句可以扩展作用域链，所以生成的代码中的 <code>_c、_l、_v、_s</code> 都是 <code>this</code> 上一些方法，也就是说在运行时执行这些方法可以生成各个节点的 vnode。</p> <p>所以联系前面的知识，响应式数据更新的整个执行过程就是：</p> <ul><li>响应式拦截到数据的更新</li> <li>dep 通知 watcher 进行异步更新</li> <li>watcher 更新时执行组件更新函数 updateComponent</li> <li>首先执行 <code>vm._render</code> 生成组件的 vnode，这时就会执行编译器生成的函数</li></ul> <h2 id="_10-一个组件是如何变成-vnode"><a href="#_10-一个组件是如何变成-vnode" class="header-anchor">#</a> 10. 一个组件是如何变成 VNode？</h2> <ul><li>组件实例初始化，最后执行 <code>$mount</code> 进入挂载阶段</li> <li>如果是只包含运行时的 vue.js，只直接进入挂载阶段，因为这时候的组件已经变成了渲染函数，编译过程通过<code>模块打包器 + vue-loader + vue-template-compiler</code> 完成的</li> <li>如果没有使用预编译，则必须使用全量的 vue.js</li> <li>挂载时如果发现组件配置项上没有 render 选项，则进入编译阶段</li> <li>将模版字符串编译成 AST 语法树，其实就是一个普通的 JS 对象</li> <li>然后优化 AST，遍历 AST 对象，标记每一个节点是否为静态静态；然后再进一步标记出静态根节点，在组件后续更新时会跳过这些静态节点的更新，以提高性能</li> <li>接下来从 AST 生成渲染函数，生成的渲染函数有两部分组成：
<ul><li>负责生成动态节点 VNode 的 render 函数</li> <li>还有一个 <code>staticRenderFns</code> 数组，里面每一个元素都是一个生成静态节点 VNode 的函数，这些函数会作为 render 函数的组成部分，负责生成静态节点的 VNode</li></ul></li> <li>接下来将渲染函数放到组件的配置对象上，进入挂载阶段，即执行 mountComponent 方法</li> <li>最终负责渲染组件和更新组件的是一个叫 updateComponent 方法，该方法每次执行前首先需要执行 <code>vm._render</code> 函数，该函数负责执行编译器生成的 render，得到组件的 VNode</li> <li>将一个组件生成 VNode 的具体工作是由 render 函数中的 <code>_c、_o、_l、_m</code> 等方法完成的，这些方法都被挂载到 Vue 实例上面，负责在运行时生成组件 VNode</li></ul> <blockquote><p>提示：到这里首先要明白什么是 VNode，一句话描述就是 —— 组件模版的 JS 对象表现形式，它就是一个普通的 JS 对象，详细描述了组件中各节点的信息</p></blockquote> <blockquote><p>下面说的有点多，其实记住一句就可以了，设置组件配置信息，然后通过 <code>new VNode(组件信息)</code> 生成组件的 VNode</p></blockquote> <ul><li><code>_c</code>，负责生成组件或 HTML 元素的 VNode，<code>_c</code> 是所有 render helper 方法中最复杂，也是最核心的一个方法，其它的 <code>_xx</code> 都是它的组成部分
<ul><li>接收标签、属性 JSON 字符串、子节点数组、节点规范化类型作为参数</li> <li>如果标签是平台保留标签或者一个未知的元素，则直接 <code>new VNode(标签信息)</code> 得到 VNode</li> <li>如果标签是一个组件，则执行 <code>createComponent</code> 方法生成 VNode
<ul><li>函数式组件执行自己的 render 函数生成 VNode</li> <li>普通组件则实例化一个 VNode，并且在在 data.hook 对象上设置 4 个方法，在组件的 patch 阶段会被调用，从而进入子组件的实例化、挂载阶段，然后进行编译生成渲染函数，直至完成渲染</li> <li>当然生成 VNode 之前会进行一些配置处理比如：
<ul><li>子组件选项合并，合并全局配置项到组件配置项上</li> <li>处理自定义组件的 v-model</li> <li>处理组件的 props，提取组件的 props 数据，以组件的 props 配置中的属性为 key，父组件中对应的数据为 value 生成一个 propsData 对象；当组件更新时生成新的 VNode，又会进行这一步，这就是 props 响应式的原理</li> <li>处理其它数据，比如监听器</li> <li>安装内置的 init、prepatch、insert、destroy 钩子到 data.hooks 对象上，组件 patch 阶段会用到这些钩子方法</li></ul></li></ul></li></ul></li> <li><code>_l</code>，运行时渲染 v-for 列表的帮助函数，循环遍历 val 值，依次为每一项执行 render 方法生成 VNode，最终返回一个 VNode 数组</li> <li><code>_m</code>，负责生成静态节点的 VNode，即执行 staticRenderFns 数组中指定下标的函数</li></ul> <p>简单总结 <code>render helper</code> 的作用就是：<strong>在 Vue 实例上挂载一些运行时的工具方法，这些方法用在编译器生成的渲染函数中，用于生成组件的 VNode</strong>。</p> <h2 id="_11-你能说一说-vue-的-patch-算法吗"><a href="#_11-你能说一说-vue-的-patch-算法吗" class="header-anchor">#</a> 11. 你能说一说 Vue 的 patch 算法吗？</h2> <p>Vue 的 patch 算法有三个作用：负责首次渲染和后续更新或者销毁组件</p> <ol><li>如果老的 VNode 是真实元素，则表示首次渲染，创建整棵 DOM 树，并插入 body，然后移除老的模版节点</li> <li>如果老的 VNode 不是真实元素，并且新的 VNode 也存在，则表示更新阶段，执行 patchVnode
<ul><li>首先是全量更新所有的属性</li> <li>如果新老 VNode 都有孩子，则递归执行 updateChildren，进行 diff 过程</li> <li><blockquote><p>针对前端操作 DOM 节点的特点进行如下优化：</p></blockquote> <ul><li>同层比较（降低时间复杂度）深度优先（递归）</li> <li>而且前端很少有完全打乱节点顺序的情况，所以做了四种假设，假设新老 VNode 的开头结尾存在相同节点，一旦命中假设，就避免了一次循环，降低了 diff 的时间复杂度，提高执行效率。如果不幸没有命中假设，则执行遍历，从老的 VNode 中找到新的 VNode 的开始节点</li> <li>找到相同节点，则执行 patchVnode，然后将老节点移动到正确的位置</li> <li>如果老的 VNode 先于新的 VNode 遍历结束，则剩余的新的 VNode 执行新增节点操作</li> <li>如果新的 VNode 先于老的 VNode 遍历结束，则剩余的老的 VNode 执行删除操纵，移除这些老节点</li></ul></li> <li>如果新的 VNode 有孩子，老的 VNode 没孩子，则新增这些新孩子节点</li> <li>如果老的 VNode 有孩子，新的 VNode 没孩子，则删除这些老孩子节点</li> <li>剩下一种就是更新文本节点</li></ul></li> <li>如果新的 VNode 不存在，老的 VNode 存在，则调用 destroy，销毁老节点</li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/vuebase/面试题/02-Prepare.html" class="prev">02-Prepare</a></span> <span class="next"><a href="/vuebase/项目实战/01-初始化开发环境.html">01-初始化开发环境</a>
      →
    </span></p></div> </main> <span data-v-2ae0ee72></span></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.5453d833.js" defer></script><script src="/assets/js/2.edd550b3.js" defer></script><script src="/assets/js/3.29a3f40f.js" defer></script><script src="/assets/js/203.b19a9896.js" defer></script>
  </body>
</html>
